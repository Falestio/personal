<!DOCTYPE html><html  data-capo=""><head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pengembangan Autoscaling Horizontal pada IDCloudHost Menggunakan Traefik Sebagai Load Balancer dan Grafana Alert</title>
<style>*,::backdrop,:after,:before{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:#3b82f680;--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/*! tailwindcss v3.4.13 | MIT License | https://tailwindcss.com*/*,:after,:before{border:0 solid #e5e7eb;box-sizing:border-box}:after,:before{--tw-content:""}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;font-family:ui-sans-serif,system-ui,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-feature-settings:normal;font-variation-settings:normal;tab-size:4;-webkit-tap-highlight-color:transparent}body{line-height:inherit;margin:0}hr{border-top-width:1px;color:inherit;height:0}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:Menlo,Monaco,Courier New,monospace,monospace;font-feature-settings:normal;font-size:1em;font-variation-settings:normal}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:initial}sub{bottom:-.25em}sup{top:-.5em}table{border-collapse:collapse;border-color:inherit;text-indent:0}button,input,optgroup,select,textarea{color:inherit;font-family:inherit;font-feature-settings:inherit;font-size:100%;font-variation-settings:inherit;font-weight:inherit;letter-spacing:inherit;line-height:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:initial;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:initial}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0}fieldset,legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{color:#9ca3af;opacity:1}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{height:auto;max-width:100%}[hidden]{display:none}.static{position:static}.fixed{position:fixed}.relative{position:relative}.inset-0{inset:0}.z-40{z-index:40}.z-50{z-index:50}.mx-2{margin-left:.5rem;margin-right:.5rem}.mx-auto{margin-left:auto;margin-right:auto}.my-4{margin-top:1rem}.mb-4,.my-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.ml-12{margin-left:3rem}.ml-2{margin-left:.5rem}.ml-4{margin-left:1rem}.block{display:block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-10{height:2.5rem}.h-20{height:5rem}.h-6{height:1.5rem}.h-8{height:2rem}.h-auto{height:auto}.max-h-\[90vh\]{max-height:90vh}.min-h-full{min-height:100%}.min-h-screen{min-height:100vh}.w-1\/3{width:33.333333%}.w-2\/12{width:16.666667%}.w-20{width:5rem}.w-24{width:6rem}.w-3\/12{width:25%}.w-36{width:9rem}.w-4{width:1rem}.w-44{width:11rem}.w-6{width:1.5rem}.w-auto{width:auto}.w-full{width:100%}.max-w-\[80vw\]{max-width:80vw}.cursor-pointer{cursor:pointer}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-2{gap:.5rem}.gap-3{gap:.75rem}.gap-4{gap:1rem}.gap-8{gap:2rem}.space-x-2>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-left:calc(.5rem*(1 - var(--tw-space-x-reverse)));margin-right:calc(.5rem*var(--tw-space-x-reverse))}.space-y-1>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(.25rem*var(--tw-space-y-reverse));margin-top:calc(.25rem*(1 - var(--tw-space-y-reverse)))}.space-y-2>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(.5rem*var(--tw-space-y-reverse));margin-top:calc(.5rem*(1 - var(--tw-space-y-reverse)))}.overflow-auto{overflow:auto}.overflow-hidden{overflow:hidden}.rounded{border-radius:.25rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:.5rem}.rounded-md{border-radius:.375rem}.rounded-l{border-bottom-left-radius:.25rem;border-top-left-radius:.25rem}.rounded-br-md{border-bottom-right-radius:.375rem}.rounded-tl-md{border-top-left-radius:.375rem}.border{border-width:1px}.border-2{border-width:2px}.border-b{border-bottom-width:1px}.border-gray-500{--tw-border-opacity:1;border-color:rgb(107 114 128/var(--tw-border-opacity))}.border-gray-600{--tw-border-opacity:1;border-color:rgb(75 85 99/var(--tw-border-opacity))}.border-yellow-400{--tw-border-opacity:1;border-color:rgb(250 204 21/var(--tw-border-opacity))}.border-l-gray-600{--tw-border-opacity:1;border-left-color:rgb(75 85 99/var(--tw-border-opacity))}.bg-black{--tw-bg-opacity:1;background-color:rgb(0 0 0/var(--tw-bg-opacity))}.bg-blue-200{--tw-bg-opacity:1;background-color:rgb(191 219 254/var(--tw-bg-opacity))}.bg-blue-500{--tw-bg-opacity:1;background-color:rgb(59 130 246/var(--tw-bg-opacity))}.bg-gray-100{--tw-bg-opacity:1;background-color:rgb(243 244 246/var(--tw-bg-opacity))}.bg-gray-200{--tw-bg-opacity:1;background-color:rgb(229 231 235/var(--tw-bg-opacity))}.bg-gray-800{--tw-bg-opacity:1;background-color:rgb(31 41 55/var(--tw-bg-opacity))}.bg-green-200{--tw-bg-opacity:1;background-color:rgb(187 247 208/var(--tw-bg-opacity))}.bg-red-500{--tw-bg-opacity:1;background-color:rgb(239 68 68/var(--tw-bg-opacity))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity))}.bg-yellow-200{--tw-bg-opacity:1;background-color:rgb(254 240 138/var(--tw-bg-opacity))}.bg-opacity-75{--tw-bg-opacity:0.75}.object-cover{object-fit:cover}.object-top{object-position:top}.p-10{padding:2.5rem}.p-3{padding:.75rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.px-1{padding-left:.25rem;padding-right:.25rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.py-1{padding-bottom:.25rem;padding-top:.25rem}.py-2{padding-bottom:.5rem;padding-top:.5rem}.pr-8{padding-right:2rem}.font-mono{font-family:Menlo,Monaco,Courier New,monospace,monospace}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-5xl{font-size:3rem;line-height:1}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.font-bold{font-weight:700}.font-semibold{font-weight:600}.text-blue-200{--tw-text-opacity:1;color:rgb(191 219 254/var(--tw-text-opacity))}.text-blue-400{--tw-text-opacity:1;color:rgb(96 165 250/var(--tw-text-opacity))}.text-blue-500{--tw-text-opacity:1;color:rgb(59 130 246/var(--tw-text-opacity))}.text-fruit-salad-100{--tw-text-opacity:1;color:rgb(233 241 231/var(--tw-text-opacity))}.text-fruit-salad-500{--tw-text-opacity:1;color:rgb(104 154 96/var(--tw-text-opacity))}.text-fruit-salad-600{--tw-text-opacity:1;color:rgb(76 116 69/var(--tw-text-opacity))}.text-gray-100{--tw-text-opacity:1;color:rgb(243 244 246/var(--tw-text-opacity))}.text-gray-300{--tw-text-opacity:1;color:rgb(209 213 219/var(--tw-text-opacity))}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175/var(--tw-text-opacity))}.text-green-200{--tw-text-opacity:1;color:rgb(187 247 208/var(--tw-text-opacity))}.text-green-500{--tw-text-opacity:1;color:rgb(34 197 94/var(--tw-text-opacity))}.text-primary{color:689a60}.text-red-500{--tw-text-opacity:1;color:rgb(239 68 68/var(--tw-text-opacity))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity))}.text-yellow-200{--tw-text-opacity:1;color:rgb(254 240 138/var(--tw-text-opacity))}.text-yellow-400{--tw-text-opacity:1;color:rgb(250 204 21/var(--tw-text-opacity))}.text-yellow-500{--tw-text-opacity:1;color:rgb(234 179 8/var(--tw-text-opacity))}.underline{text-decoration-line:underline}.shadow{--tw-shadow:0 1px 3px 0 #0000001a,0 1px 2px -1px #0000001a;--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color),0 1px 2px -1px var(--tw-shadow-color)}.shadow,.shadow-md{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-md{--tw-shadow:0 4px 6px -1px #0000001a,0 2px 4px -2px #0000001a;--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color),0 2px 4px -2px var(--tw-shadow-color)}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.transition{transition-duration:.15s;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1)}.hover\:border-fruit-salad-600:hover{--tw-border-opacity:1;border-color:rgb(76 116 69/var(--tw-border-opacity))}.hover\:bg-\[\#0A66C2\]:hover{--tw-bg-opacity:1;background-color:rgb(10 102 194/var(--tw-bg-opacity))}.hover\:bg-blue-600:hover{--tw-bg-opacity:1;background-color:rgb(37 99 235/var(--tw-bg-opacity))}.hover\:bg-fruit-salad-400:hover{--tw-bg-opacity:1;background-color:rgb(131 172 124/var(--tw-bg-opacity))}.hover\:bg-red-600:hover{--tw-bg-opacity:1;background-color:rgb(220 38 38/var(--tw-bg-opacity))}.hover\:underline:hover{text-decoration-line:underline}.focus\:outline-none:focus{outline:2px solid #0000;outline-offset:2px}@media (min-width:1024px){.lg\:sticky{position:sticky}.lg\:top-0{top:0}.lg\:block{display:block}.lg\:hidden{display:none}.lg\:max-h-screen{max-height:100vh}.lg\:w-7\/12{width:58.333333%}.lg\:flex-row{flex-direction:row}.lg\:overflow-y-auto{overflow-y:auto}}.dark\:border-gray-200:where([class~=dark-mode],[class~=dark-mode] *){--tw-border-opacity:1;border-color:rgb(229 231 235/var(--tw-border-opacity))}.dark\:border-gray-700:where([class~=dark-mode],[class~=dark-mode] *){--tw-border-opacity:1;border-color:rgb(55 65 81/var(--tw-border-opacity))}.dark\:bg-black:where([class~=dark-mode],[class~=dark-mode] *){--tw-bg-opacity:1;background-color:rgb(0 0 0/var(--tw-bg-opacity))}.dark\:bg-gray-700:where([class~=dark-mode],[class~=dark-mode] *){--tw-bg-opacity:1;background-color:rgb(55 65 81/var(--tw-bg-opacity))}.dark\:bg-gray-800:where([class~=dark-mode],[class~=dark-mode] *){--tw-bg-opacity:1;background-color:rgb(31 41 55/var(--tw-bg-opacity))}.dark\:bg-slate-700:where([class~=dark-mode],[class~=dark-mode] *){--tw-bg-opacity:1;background-color:rgb(51 65 85/var(--tw-bg-opacity))}.dark\:bg-slate-800:where([class~=dark-mode],[class~=dark-mode] *){--tw-bg-opacity:1;background-color:rgb(30 41 59/var(--tw-bg-opacity))}.dark\:bg-slate-900:where([class~=dark-mode],[class~=dark-mode] *){--tw-bg-opacity:1;background-color:rgb(15 23 42/var(--tw-bg-opacity))}.dark\:text-fruit-salad-400:where([class~=dark-mode],[class~=dark-mode] *){--tw-text-opacity:1;color:rgb(131 172 124/var(--tw-text-opacity))}.dark\:text-slate-50:where([class~=dark-mode],[class~=dark-mode] *){--tw-text-opacity:1;color:rgb(248 250 252/var(--tw-text-opacity))}</style>
<style>*,:after,:before{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/*! tailwindcss v3.4.13 | MIT License | https://tailwindcss.com*/*,:after,:before{border:0 solid #e5e7eb;box-sizing:border-box}:after,:before{--tw-content:""}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;font-family:ui-sans-serif,system-ui,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-feature-settings:normal;font-variation-settings:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-tap-highlight-color:transparent}body{line-height:inherit;margin:0}hr{border-top-width:1px;color:inherit;height:0}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:Menlo,Monaco,Courier New,monospace,monospace;font-feature-settings:normal;font-size:1em;font-variation-settings:normal}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{border-collapse:collapse;border-color:inherit;text-indent:0}button,input,optgroup,select,textarea{color:inherit;font-family:inherit;font-feature-settings:inherit;font-size:100%;font-variation-settings:inherit;font-weight:inherit;letter-spacing:inherit;line-height:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0}fieldset,legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#9ca3af;opacity:1}input::placeholder,textarea::placeholder{color:#9ca3af;opacity:1}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{height:auto;max-width:100%}[hidden]{display:none}.static{position:static}.fixed{position:fixed}.relative{position:relative}.inset-0{inset:0}.z-40{z-index:40}.z-50{z-index:50}.mx-2{margin-left:.5rem;margin-right:.5rem}.mx-auto{margin-left:auto;margin-right:auto}.my-4{margin-top:1rem}.mb-4,.my-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.ml-12{margin-left:3rem}.ml-2{margin-left:.5rem}.ml-4{margin-left:1rem}.block{display:block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-10{height:2.5rem}.h-20{height:5rem}.h-6{height:1.5rem}.h-8{height:2rem}.h-auto{height:auto}.max-h-\[90vh\]{max-height:90vh}.min-h-full{min-height:100%}.min-h-screen{min-height:100vh}.w-1\/3{width:33.333333%}.w-2\/12{width:16.666667%}.w-20{width:5rem}.w-24{width:6rem}.w-3\/12{width:25%}.w-36{width:9rem}.w-4{width:1rem}.w-44{width:11rem}.w-6{width:1.5rem}.w-auto{width:auto}.w-full{width:100%}.max-w-\[80vw\]{max-width:80vw}.cursor-pointer{cursor:pointer}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-2{gap:.5rem}.gap-3{gap:.75rem}.gap-4{gap:1rem}.gap-8{gap:2rem}.space-x-2>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-left:calc(.5rem*(1 - var(--tw-space-x-reverse)));margin-right:calc(.5rem*var(--tw-space-x-reverse))}.space-y-1>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(.25rem*var(--tw-space-y-reverse));margin-top:calc(.25rem*(1 - var(--tw-space-y-reverse)))}.space-y-2>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(.5rem*var(--tw-space-y-reverse));margin-top:calc(.5rem*(1 - var(--tw-space-y-reverse)))}.overflow-auto{overflow:auto}.overflow-hidden{overflow:hidden}.rounded{border-radius:.25rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:.5rem}.rounded-md{border-radius:.375rem}.rounded-l{border-bottom-left-radius:.25rem;border-top-left-radius:.25rem}.rounded-br-md{border-bottom-right-radius:.375rem}.rounded-tl-md{border-top-left-radius:.375rem}.border{border-width:1px}.border-2{border-width:2px}.border-b{border-bottom-width:1px}.border-gray-500{--tw-border-opacity:1;border-color:rgb(107 114 128/var(--tw-border-opacity))}.border-gray-600{--tw-border-opacity:1;border-color:rgb(75 85 99/var(--tw-border-opacity))}.border-yellow-400{--tw-border-opacity:1;border-color:rgb(250 204 21/var(--tw-border-opacity))}.border-l-gray-600{--tw-border-opacity:1;border-left-color:rgb(75 85 99/var(--tw-border-opacity))}.bg-black{--tw-bg-opacity:1;background-color:rgb(0 0 0/var(--tw-bg-opacity))}.bg-blue-200{--tw-bg-opacity:1;background-color:rgb(191 219 254/var(--tw-bg-opacity))}.bg-blue-500{--tw-bg-opacity:1;background-color:rgb(59 130 246/var(--tw-bg-opacity))}.bg-gray-100{--tw-bg-opacity:1;background-color:rgb(243 244 246/var(--tw-bg-opacity))}.bg-gray-200{--tw-bg-opacity:1;background-color:rgb(229 231 235/var(--tw-bg-opacity))}.bg-gray-800{--tw-bg-opacity:1;background-color:rgb(31 41 55/var(--tw-bg-opacity))}.bg-green-200{--tw-bg-opacity:1;background-color:rgb(187 247 208/var(--tw-bg-opacity))}.bg-red-500{--tw-bg-opacity:1;background-color:rgb(239 68 68/var(--tw-bg-opacity))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity))}.bg-yellow-200{--tw-bg-opacity:1;background-color:rgb(254 240 138/var(--tw-bg-opacity))}.bg-opacity-75{--tw-bg-opacity:0.75}.object-cover{-o-object-fit:cover;object-fit:cover}.object-top{-o-object-position:top;object-position:top}.p-10{padding:2.5rem}.p-3{padding:.75rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.px-1{padding-left:.25rem;padding-right:.25rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.py-1{padding-bottom:.25rem;padding-top:.25rem}.py-2{padding-bottom:.5rem;padding-top:.5rem}.pr-8{padding-right:2rem}.font-mono{font-family:Menlo,Monaco,Courier New,monospace,monospace}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-5xl{font-size:3rem;line-height:1}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.font-bold{font-weight:700}.font-semibold{font-weight:600}.text-blue-200{--tw-text-opacity:1;color:rgb(191 219 254/var(--tw-text-opacity))}.text-blue-400{--tw-text-opacity:1;color:rgb(96 165 250/var(--tw-text-opacity))}.text-blue-500{--tw-text-opacity:1;color:rgb(59 130 246/var(--tw-text-opacity))}.text-fruit-salad-100{--tw-text-opacity:1;color:rgb(233 241 231/var(--tw-text-opacity))}.text-fruit-salad-500{--tw-text-opacity:1;color:rgb(104 154 96/var(--tw-text-opacity))}.text-fruit-salad-600{--tw-text-opacity:1;color:rgb(76 116 69/var(--tw-text-opacity))}.text-gray-100{--tw-text-opacity:1;color:rgb(243 244 246/var(--tw-text-opacity))}.text-gray-300{--tw-text-opacity:1;color:rgb(209 213 219/var(--tw-text-opacity))}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175/var(--tw-text-opacity))}.text-green-200{--tw-text-opacity:1;color:rgb(187 247 208/var(--tw-text-opacity))}.text-green-500{--tw-text-opacity:1;color:rgb(34 197 94/var(--tw-text-opacity))}.text-primary{color:689a60}.text-red-500{--tw-text-opacity:1;color:rgb(239 68 68/var(--tw-text-opacity))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity))}.text-yellow-200{--tw-text-opacity:1;color:rgb(254 240 138/var(--tw-text-opacity))}.text-yellow-400{--tw-text-opacity:1;color:rgb(250 204 21/var(--tw-text-opacity))}.text-yellow-500{--tw-text-opacity:1;color:rgb(234 179 8/var(--tw-text-opacity))}.underline{text-decoration-line:underline}.shadow{--tw-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px -1px rgba(0,0,0,.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color),0 1px 2px -1px var(--tw-shadow-color)}.shadow,.shadow-md{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-md{--tw-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -2px rgba(0,0,0,.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color),0 2px 4px -2px var(--tw-shadow-color)}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.transition{transition-duration:.15s;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1)}.no-scrollbar::-webkit-scrollbar{display:none}.no-scrollbar{-ms-overflow-style:none;scrollbar-width:none}::-webkit-scrollbar{height:10px;width:10px}::-webkit-scrollbar-track{background:#374151}::-webkit-scrollbar-thumb{background:#64748b}.article h1,.article h2,.article h3,.article h4,.article h5,.article h6{font-family:Menlo,Monaco,Courier New,monospace,monospace;font-weight:700}.article h1{font-size:3rem;line-height:1;margin-bottom:1rem;margin-top:2rem}.article h2{font-size:2.25rem;line-height:2.5rem;margin-bottom:.75rem;margin-top:1.5rem}.article h3{font-size:1.875rem;line-height:2.25rem}.article h3,.article h4{margin-bottom:.5rem;margin-top:1rem}.article h4{font-size:1.5rem;line-height:2rem}.article h5{font-size:1.25rem;margin-top:.75rem}.article h5,.article h6{line-height:1.75rem;margin-bottom:.25rem}.article h6{font-size:1.125rem;margin-top:.5rem}.article p{font-size:1.125rem;line-height:1.75rem;line-height:1.625;margin-bottom:1rem;margin-top:1rem}.article a{color:689a60;--tw-text-opacity:1;color:rgb(104 154 96/var(--tw-text-opacity));text-decoration-line:underline}.article h1 a,.article h2 a,.article h3 a,.article h4 a,.article h5 a,.article h6 a{color:inherit;text-decoration-line:none}.article img{border-radius:.5rem;height:auto;margin-bottom:1rem;margin-top:1rem;width:100%;--tw-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -4px rgba(0,0,0,.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.custom-list-style ul{list-style-type:disc;margin-bottom:1rem;margin-left:1.5rem}.custom-list-style ol{list-style-type:decimal;margin-bottom:1rem;margin-left:1.5rem}.custom-list-style ul ul{list-style-type:square;margin-left:1.5rem}.custom-list-style ul ul ul{list-style-type:disc;margin-left:1.5rem}.custom-list-style ul ul ul ul{list-style-type:square;margin-left:1.5rem}.custom-list-style li{font-size:1.125rem;line-height:1.75rem;margin-bottom:.5rem}.article blockquote,.custom-list-style li>*{margin-bottom:1rem;margin-top:1rem}.article blockquote{border-left-width:4px;--tw-border-opacity:1;border-color:rgb(209 213 219/var(--tw-border-opacity));font-style:italic;padding-left:1rem}.custom-table-style table{border-collapse:collapse;margin-bottom:1rem;margin-top:1rem;width:100%}.custom-table-style td,.custom-table-style th{border-width:1px;--tw-border-opacity:1;border-color:rgb(209 213 219/var(--tw-border-opacity));padding:.5rem 1rem}.custom-table-style th{--tw-bg-opacity:1;background-color:rgb(243 244 246/var(--tw-bg-opacity));font-weight:600}.custom-table-style th:where([class~=dark-mode],[class~=dark-mode] *){--tw-bg-opacity:1;background-color:rgb(55 65 81/var(--tw-bg-opacity))}.custom-table-style tr:nth-child(2n){--tw-bg-opacity:1;background-color:rgb(249 250 251/var(--tw-bg-opacity))}.custom-table-style tr:nth-child(2n):where([class~=dark-mode],[class~=dark-mode] *){--tw-bg-opacity:1;background-color:rgb(55 65 81/var(--tw-bg-opacity))}.hover\:border-fruit-salad-600:hover{--tw-border-opacity:1;border-color:rgb(76 116 69/var(--tw-border-opacity))}.hover\:bg-\[\#0A66C2\]:hover{--tw-bg-opacity:1;background-color:rgb(10 102 194/var(--tw-bg-opacity))}.hover\:bg-blue-600:hover{--tw-bg-opacity:1;background-color:rgb(37 99 235/var(--tw-bg-opacity))}.hover\:bg-fruit-salad-400:hover{--tw-bg-opacity:1;background-color:rgb(131 172 124/var(--tw-bg-opacity))}.hover\:bg-red-600:hover{--tw-bg-opacity:1;background-color:rgb(220 38 38/var(--tw-bg-opacity))}.hover\:underline:hover{text-decoration-line:underline}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}@media (min-width:1024px){.lg\:sticky{position:sticky}.lg\:top-0{top:0}.lg\:block{display:block}.lg\:hidden{display:none}.lg\:max-h-screen{max-height:100vh}.lg\:w-7\/12{width:58.333333%}.lg\:flex-row{flex-direction:row}.lg\:overflow-y-auto{overflow-y:auto}}.dark\:border-gray-200:where([class~=dark-mode],[class~=dark-mode] *){--tw-border-opacity:1;border-color:rgb(229 231 235/var(--tw-border-opacity))}.dark\:border-gray-700:where([class~=dark-mode],[class~=dark-mode] *){--tw-border-opacity:1;border-color:rgb(55 65 81/var(--tw-border-opacity))}.dark\:bg-black:where([class~=dark-mode],[class~=dark-mode] *){--tw-bg-opacity:1;background-color:rgb(0 0 0/var(--tw-bg-opacity))}.dark\:bg-gray-700:where([class~=dark-mode],[class~=dark-mode] *){--tw-bg-opacity:1;background-color:rgb(55 65 81/var(--tw-bg-opacity))}.dark\:bg-gray-800:where([class~=dark-mode],[class~=dark-mode] *){--tw-bg-opacity:1;background-color:rgb(31 41 55/var(--tw-bg-opacity))}.dark\:bg-slate-700:where([class~=dark-mode],[class~=dark-mode] *){--tw-bg-opacity:1;background-color:rgb(51 65 85/var(--tw-bg-opacity))}.dark\:bg-slate-800:where([class~=dark-mode],[class~=dark-mode] *){--tw-bg-opacity:1;background-color:rgb(30 41 59/var(--tw-bg-opacity))}.dark\:bg-slate-900:where([class~=dark-mode],[class~=dark-mode] *){--tw-bg-opacity:1;background-color:rgb(15 23 42/var(--tw-bg-opacity))}.dark\:text-fruit-salad-400:where([class~=dark-mode],[class~=dark-mode] *){--tw-text-opacity:1;color:rgb(131 172 124/var(--tw-text-opacity))}.dark\:text-slate-50:where([class~=dark-mode],[class~=dark-mode] *){--tw-text-opacity:1;color:rgb(248 250 252/var(--tw-text-opacity))}</style>
<style>.no-scrollbar{scrollbar-width:none}.no-scrollbar::-webkit-scrollbar{display:none}</style>
<link rel="preload" as="fetch" crossorigin="anonymous" href="/blog/autoscaling-pada-idcloudhost-menggunakan-grafana-traefik/_payload.json?492af120-ee34-4ae2-b810-b2432bee4326">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/BGD-0X9U.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/D0y-MLVw.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/BYUdcoaC.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/Be4jkiMP.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/flAiz7XE.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/C9xAvToS.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/CHUN2Y8Q.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/D5rCYqM8.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/nqx12DVY.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/C9CDhKg1.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/C-v3KzvZ.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/Dnd51l0P.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/DYJ-RiTK.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/DLBaVC3n.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/VdA4qHvA.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/Dn_CSi-_.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/DatODRln.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/CekyknTS.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/CbAlkHVh.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/yZMIgZ9p.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/WXsXz31Z.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/DYNbzSbH.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/CQx2M3_J.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/CtQtUy6_.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/DlO3Qy8f.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/DfGp_Uc6.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/BvxmjEyO.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/C9Rp83-b.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/BS1EmR7l.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/CbHNHgOv.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/CUu_Mtxq.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/Cd-mCDvs.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/OlsOFBlR.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/DPaTp3gH.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/BcQmUnL2.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/CovIkqXP.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/C2Bea2ke.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/DmjW66U4.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/DnjXAa7j.js">
<link rel="prefetch" as="style" href="/_nuxt/useStudio.CjCom-nn.css">
<link rel="prefetch" as="script" crossorigin href="/_nuxt/DNGwjwqt.js">
<link rel="prefetch" as="script" crossorigin href="/_nuxt/DN_KAFF5.js">
<link rel="prefetch" as="script" crossorigin href="/_nuxt/DOLhJso2.js">
<meta property="og:title" content="Pengembangan Autoscaling Horizontal pada IDCloudHost Menggunakan Traefik Sebagai Load Balancer dan Grafana Alert">
<meta name="description" content="An overview of Traefik and its role as an API Gateway in modern web applications.">
<meta property="og:description" content="An overview of Traefik and its role as an API Gateway in modern web applications.">
<script type="module" src="/_nuxt/BGD-0X9U.js" crossorigin></script><script>"use strict";(()=>{const t=window,e=document.documentElement,c=["dark","light"],n=getStorageValue("localStorage","nuxt-color-mode")||"system";let i=n==="system"?u():n;const r=e.getAttribute("data-color-mode-forced");r&&(i=r),l(i),t["__NUXT_COLOR_MODE__"]={preference:n,value:i,getColorScheme:u,addColorScheme:l,removeColorScheme:d};function l(o){const s=""+o+"-mode",a="";e.classList?e.classList.add(s):e.className+=" "+s,a&&e.setAttribute("data-"+a,o)}function d(o){const s=""+o+"-mode",a="";e.classList?e.classList.remove(s):e.className=e.className.replace(new RegExp(s,"g"),""),a&&e.removeAttribute("data-"+a)}function f(o){return t.matchMedia("(prefers-color-scheme"+o+")")}function u(){if(t.matchMedia&&f("").media!=="not all"){for(const o of c)if(f(":"+o).matches)return o}return"light"}})();function getStorageValue(t,e){switch(t){case"localStorage":return window.localStorage.getItem(e);case"sessionStorage":return window.sessionStorage.getItem(e);case"cookie":return getCookie(e);default:return null}}function getCookie(t){const c=("; "+window.document.cookie).split("; "+t+"=");if(c.length===2)return c.pop()?.split(";").shift()}</script></head><body><div id="__nuxt"><div class="dark:bg-slate-900 dark:text-slate-50"><div class="nuxt-loading-indicator" style="position:fixed;top:0;right:0;left:0;pointer-events:none;width:auto;height:3px;opacity:0;background:repeating-linear-gradient(to right,#00dc82 0%,#34cdfe 50%,#0047e1 100%);background-size:Infinity% auto;transform:scaleX(0%);transform-origin:left;transition:transform 0.1s, height 0.4s, opacity 0.4s;z-index:999999;"></div><div><div class="bg-gray-800 text-white p-4 lg:hidden flex justify-between items-center"><a href="/" class=""><img onerror="this.setAttribute(&#39;data-error&#39;, 1)" data-nuxt-img srcset="/_ipx/_/img/logo-personal.png 1x, /_ipx/_/img/logo-personal.png 2x" class="w-36 h-auto" src="/_ipx/_/img/logo-personal.png"></a><button class="focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor"><!--[--><!--]--><g><path d="M224,128a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,128ZM40,72H216a8,8,0,0,0,0-16H40a8,8,0,0,0,0,16ZM216,184H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path></g></svg></button></div><div class="flex flex-col lg:flex-row min-h-screen"><div class="hidden lg:block w-2/12 bg-gray-200 dark:bg-slate-800 p-4 lg:sticky lg:top-0 lg:max-h-screen lg:overflow-y-auto"><div class="p-4"><ul class="space-y-2 font-mono text-2xl"><li><a href="/" class="hover:underline">Home</a></li><li><a href="/about" class="hover:underline">About</a></li><nav aria-label="breadcrumb"><ol class="flex flex-col space-x-2"><!----><!--[--><li class="block"><a href="/blog" class="hover:underline text-primary">Blog</a><span class="mx-2 text-gray-400">/</span></li><li class="block"><span class="text-primary">Autoscaling Pada Idcloudhost Menggunakan Grafana Traefik</span><!----></li><!--]--></ol></nav></ul></div></div><div class="w-full lg:w-7/12 p-4"><!--[--><div><div class="flex justify-center"><!--[--><div class="article custom-list-style custom-table-style custom-inline-code w-full p-4"><h1 id="pengembangan-autoscaling-horizontal-pada-idcloudhost-menggunakan-traefik-sebagai-load-balancer-dan-grafana-alert"><!--[-->Pengembangan Autoscaling Horizontal pada IDCloudHost Menggunakan Traefik Sebagai Load Balancer dan Grafana Alert<!--]--></h1><p><!--[-->IDCloudHost menyediakan virtual machine (VM) dengan harga yang relatif terjangkau dibandingkan penyedia layanan cloud lainnya, seperti AWS atau DigitalOcean.<!--]--></p><table><!--[--><thead><!--[--><tr><!--[--><th><!--[-->Provider<!--]--></th><th><!--[-->Harga dalam USD<!--]--></th><th><!--[-->Harga dalam IDR<!--]--></th><!--]--></tr><!--]--></thead><tbody><!--[--><tr><!--[--><td><!--[-->AWS (On-Demand, T3 Small, 2 CPU, 2 GiB RAM, 60 GB EBS Storage)<!--]--></td><td><!--[-->$25.03<!--]--></td><td><!--[-->Rp 391.939<!--]--></td><!--]--></tr><tr><!--[--><td><!--[-->DigitalOcean Droplet (2 CPU, 2 GiB RAM, 60 GB Storage)<!--]--></td><td><!--[-->$18.00<!--]--></td><td><!--[-->Rp 281.826<!--]--></td><!--]--></tr><tr><!--[--><td><!--[-->IDCloudHost (2 CPU, 2 GiB RAM, 60 GB Storage)<!--]--></td><td><!--[-->$7.19<!--]--></td><td><!--[-->Rp 112.500<!--]--></td><!--]--></tr><!--]--></tbody><!--]--></table><p><!--[-->*Data diambil pada 8 Oktober 2024<!--]--></p><ul><!--[--><li><!--[-->Harga AWS diperoleh dari AWS Pricing Calculator.<!--]--></li><li><!--[-->Harga DigitalOcean diperoleh dari halaman pricing Droplets.<!--]--></li><li><!--[-->Harga IDCloudHost diperoleh dari halaman console saat membuat VM baru.<!--]--></li><li><!--[-->Kurs: 1 Dollar = Rp 15.657 (8 Oktober 2024).<!--]--></li><!--]--></ul><p><!--[-->Meskipun harganya lebih terjangkau, IDCloudHost tidak memiliki fitur yang selengkap penyedia lain, seperti autoscaling.<!--]--></p><p><!--[-->Fitur autoscaling sangat penting untuk menangani peningkatan trafik secara otomatis, tanpa memerlukan intervensi manual. Saat ini, IDCloudHost menyediakan fitur self-upgrade dan self-downgrade pada layanannya. Meskipun memungkinkan scaling secara manual, fitur ini tidak seotomatis autoscaling pada layanan cloud besar lainnya.<!--]--></p><p><!--[-->Namun, IDCloudHost menyediakan API yang dapat digunakan untuk mengelola setiap sumber daya, termasuk membuat dan menghapus VM.<!--]--></p><p><!--[-->Artikel ini akan menjelaskan cara memanfaatkan API ini untuk keperluan autoscaling dengan bantuan Grafana <em><!--[-->alert<!--]--></em> dan <em><!--[-->load balancer<!--]--></em> dari Traefik.<!--]--></p><h2 id="gambaran-sistem-yang-akan-dibuat"><a href="#gambaran-sistem-yang-akan-dibuat"><!--[-->Gambaran Sistem yang Akan Dibuat<!--]--></a></h2><p><!--[-->Gambar di bawah adalah gambaran umum dari sistem autoscaling yang akan dibuat:<!--]--></p><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/general-archi.svg" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><ul><!--[--><li><!--[-->Kelompok <em><!--[--><code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->service-clones<!--]--></code><!--]--></em><br><em><!--[-->Service clones<!--]--></em> adalah kumpulan <em><!--[-->virtual machine<!--]--></em> yang akan <em><!--[-->di-autoscale<!--]--></em>. Kelompok virtual machine ini dibuat dari sebuah &quot;service seed,&quot; yaitu virtual machine utama yang berfungsi sebagai template. Service seed berisi aplikasi dan konfigurasi yang diperlukan, dan setiap service clone yang dibuat merupakan salinan dari service seed.<!--]--></li><li><!--[--><code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->Traefik API Gateway &amp; Load Balancer<!--]--></code><br>
Traefik adalah <em><!--[-->HTTP reverse proxy<!--]--></em> yang sejenis dengan NGINX namun menawarkan konfigurasi yang lebih user-friendly. Pada artikel ini, Traefik akan digunakan sebagai <em><!--[-->API gateway<!--]--></em> dan <em><!--[-->load balancer<!--]--></em> yang bertugas sebagai lapisan pertama sebelum request.<div class="rounded-lg shadow-md overflow-hidden flex mb-4" data-v-2ca7e668><div class="bg-green-200 w-4 min-h-full" data-v-2ca7e668></div><div class="bg-white dark:bg-gray-800" data-v-2ca7e668><div class="text-green-200 flex items-center gap-2 px-2 py-2" data-v-2ca7e668><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="text-green-500" data-v-2ca7e668><!--[--><!--]--><g><path d="M140,180a12,12,0,1,1-12-12A12,12,0,0,1,140,180ZM128,72c-22.06,0-40,16.15-40,36v4a8,8,0,0,0,16,0v-4c0-11,10.77-20,24-20s24,9,24,20-10.77,20-24,20a8,8,0,0,0-8,8v8a8,8,0,0,0,16,0v-.72c18.24-3.35,32-17.9,32-35.28C168,88.15,150.06,72,128,72Zm104,56A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"></path></g></svg><span class="text-xl font-bold rounded" data-v-2ca7e668>Kenapa tidak menggunakan load balancer dari IdCloudHost?</span></div><div class="px-2" data-v-2ca7e668><!--[--><p><!--[-->Kendala utama dalam menggunakan load balancer bawaan IDCloudHost adalah keterbatasan pengendalian. Load balancer ini hanya mendukung metode session persistence yang tidak dapat diubah. Selain itu, biaya penggunaannya relatif tinggi yaitu Rp 150.000 per bulan dibanding membuat load balancer sendiri cukup dengan Rp 87.000 per bulan untuk konfigurasi 2 vCPU dan 2 GB RAM.<!--]--></p><!--]--></div></div></div><!--]--></li><li><!--[--><code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->Grafana &amp; Prometheus Monitoring Server<!--]--></code><br>
Grafana dan Prometheus digunakan untuk monitoring dan pengiriman notifikasi. Prometheus berperan sebagai sumber data, sementara Grafana digunakan untuk visualisasi data dan penerapan fungsi alert yang dapat memicu scale up atau scale down.<!--]--></li><li><!--[--><code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->IDCloudHost API<!--]--></code><br>
Ini adalah API yang telah disediakan IDCloudHost. API ini memungkinkan pengguna berinteraksi dengan setiap resource yang ada di IDCloudHost, seperti membuat, menghapus, dan mengedit virtual machine.<!--]--></li><li><!--[--><code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->IDCloudHost VPC Network<!--]--></code><br>
VPC memungkinkan server berkomunikasi melalui jaringan privat, yang mengurangi area potensi serangan oleh hacker.<!--]--></li><!--]--></ul><h2 id="penjelasan-stack-yang-dipilih"><a href="#penjelasan-stack-yang-dipilih"><!--[-->Penjelasan Stack yang Dipilih<!--]--></a></h2><h3 id="traefik"><a href="#traefik"><!--[-->Traefik<!--]--></a></h3><p><!--[-->Traefik adalah <em><!--[-->reverse proxy<!--]--></em> dan <em><!--[-->load balancer<!--]--></em> <em><!--[-->open-source<!--]--></em> yang dirancang untuk mengatur traffic HTTP dan TCP di lingkungan mikroservis. Traefik dapat dijadikan API gateway, load balancer, dan proxy untuk server VM, Docker, atau Kubernetes.<!--]--></p><p><!--[-->Traefik memiliki banyak turunan yang menangani <em><!--[-->use case<!--]--></em> yang berbeda, namun yang akan kita gunakan adalah <a href="https://doc.traefik.io/traefik/" rel="nofollow"><!--[-->Traefik Proxy<!--]--></a>.<!--]--></p><p><!--[-->Alasan memilih Traefik adalah kemampuannya menyimpan konfigurasi dalam file yang dinamis. Artinya, perubahan dapat dilakukan langsung pada file tersebut tanpa perlu me-restart virtual machine. Ini sangat penting dalam peristiwa scaling, di mana konfigurasi sering diperbarui untuk menambah atau mengurangi daftar service yang terhubung ke load balancer. Dengan tidak perlu me-restart VM, downtime dapat dihindari selama proses scaling.<!--]--></p><p><!--[-->Saat ini, Traefik hanya mendukung metode load balancing <strong><!--[-->round robin<!--]--></strong>.<!--]--></p><h3 id="grafana"><a href="#grafana"><!--[-->Grafana<!--]--></a></h3><p><!--[-->Grafana adalah platform open-source yang berfungsi untuk menganalisis, memonitor, dan menvisualisasikan data dari berbagai macam sumber.<!--]--></p><p><!--[-->Pada artikel ini, Grafana akan digunakan untuk melakukan monitoring terhadap load dari server yang akan di-scaling.<!--]--></p><p><!--[-->Selain itu, Grafana juga memiliki fitur alert yang akan digunakan untuk menginisiasi peristiwa scale up atau scale down.<!--]--></p><h3 id="prometheus"><a href="#prometheus"><!--[-->Prometheus<!--]--></a></h3><p><!--[--><a href="https://prometheus.io/docs/introduction/overview/" rel="nofollow"><!--[-->Prometheus<!--]--></a> adalah tool open-source untuk monitoring dan alerting yang dirancang untuk mengumpulkan, menyimpan, dan menganalisis data layanan dan infrastruktur. Biasanya, Prometheus digunakan bersama Grafana untuk menvisualisasikan data.<!--]--></p><p><!--[-->Kita akan menggunakan Prometheus bersama Node Exporter.<!--]--></p><p><!--[-->Node Exporter adalah klien yang akan mengumpulkan dan mengirimkan data <em><!--[-->system-level<!--]--></em> (penggunaan CPU, RAM, Disk) ke Prometheus.<!--]--></p><h2 id="alur-kerja-sistem"><a href="#alur-kerja-sistem"><!--[-->Alur Kerja Sistem<!--]--></a></h2><p><!--[-->Gambar di bawah menunjukkan alur sistem bekerja:<!--]--></p><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/cara-kerja-umum.svg" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><ol><!--[--><li><!--[-->Pengguna mengirim permintaan ke endpoint yang diekspos oleh Traefik melalui HTTP atau HTTPS.<!--]--></li><li><!--[-->Traefik berfungsi sebagai load balancer dan meneruskan permintaan ke layanan sesuai giliran, menggunakan metode round robin.<!--]--></li><li><!--[-->Setiap service akan mengirimkan data ke server monitoring.<!--]--></li><li><!--[-->Ketika beban CPU melebihi atau kurang dari ambang batas yang ditentukan, server monitoring akan mengirim perintah ke API IDCloudHost untuk melakukan scale up atau scale down, menggunakan Grafana alert.<!--]--></li><li><!--[-->API IDCloudHost kemudian akan melakukan scaling. Jika scale up, service seed akan di-clone untuk membuat service baru. Jika melakukan scale down, VM terakhir yang di-clone akan dihapus.<!--]--></li><li><!--[-->Jika service clone berhasil dibuat (scale up), maka akan terhubung dengan Traefik dan server monitoring. Jika berhasil dihapus (scale down), koneksi antara Traefik dan server monitoring akan diputus.<!--]--></li><!--]--></ol><h2 id="penjelasan-lanjut-cara-kerja-scale-up"><a href="#penjelasan-lanjut-cara-kerja-scale-up"><!--[-->Penjelasan Lanjut Cara Kerja Scale Up<!--]--></a></h2><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/cara-kerja-detail-1.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><p><!--[-->Saat sistem menerima banyak request, <em><!--[-->system load<!--]--></em> akan meningkat. Jika ini terjadi, sistem akan gagal untuk memproses beberapa request, sehingga perlu dilakukan <em><!--[-->scale up<!--]--></em> untuk menangani beban tambahan tersebut.<!--]--></p><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/cara-kerja-detail-2.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><p><!--[-->Tahapan untuk event scale-up dijelaskan pada gambar kedua:<!--]--></p><ol><!--[--><li><!--[-->Banyak <em><!--[-->request<!--]--></em> yang datang menyebabkan layanan mengalami <em><!--[-->load<!--]--></em> yang tinggi, yang pada akhirnya menghasilkan kegagalan memproses <em><!--[-->request<!--]--></em>.<!--]--></li><li><!--[-->Prometheus mengumpulkan data penggunaan sistem (CPU dan RAM usage).<!--]--></li><li><!--[-->Grafana mendeteksi tingkat penggunaan sistem di atas batas yang ditentukan. Sehingga event scale up terjadi dimulai dengan memanggil webhook scale up.<!--]--></li><li><!--[-->Handler dari webhook scale up akan berinteraksi dengan API IDCloudHost untuk melakukan cloning terhadap service seed.<!--]--></li><li><!--[-->Setelah VM service seed berhasil di-clone, webhook handler akan memperbarui daftar target di server Prometheus di server monitoring untuk menyertakan server yang baru dibuat.<!--]--></li><li><!--[-->Webhook handler kemudian akan mengirim permintaan ke target updater pada server Traefik untuk memperbarui daftar target load balancer, memasukkan server baru ke dalam daftar target.<!--]--></li><li><!--[-->Target updater pada server Traefik akan memperbarui daftar IP dan menambahkan alamat IP privat dari service clone yang baru.<!--]--></li><!--]--></ol><div class="rounded-lg shadow-md overflow-hidden flex mb-4" data-v-2ca7e668><div class="bg-blue-200 w-4 min-h-full" data-v-2ca7e668></div><div class="bg-white dark:bg-gray-800" data-v-2ca7e668><div class="text-blue-200 flex items-center gap-2 px-2 py-2" data-v-2ca7e668><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="text-blue-500" data-v-2ca7e668><!--[--><!--]--><g><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm16-40a8,8,0,0,1-8,8,16,16,0,0,1-16-16V128a8,8,0,0,1,0-16,16,16,0,0,1,16,16v40A8,8,0,0,1,144,176ZM112,84a12,12,0,1,1,12,12A12,12,0,0,1,112,84Z"></path></g></svg><span class="text-xl font-bold rounded" data-v-2ca7e668>Tentang Daftar Target</span></div><div class="px-2" data-v-2ca7e668><!--[--><p><!--[-->Bentuk daftar target adalah URL yang menuju ke service clone/seed beserta dengan portnya. Daftar URL ini disimpan pada file konfigurasi Traefik dan Prometheus.<!--]--></p><!--]--></div></div></div><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/cara-kerja-detail-3.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><p><!--[-->Gambar ketiga menunjukkan hasil dari operasi di atas:<!--]--></p><ol><!--[--><li><!--[-->Nomor satu menunjukkan service clone hasil dari langkah nomor 4 pada bagian sebelumnya. Semua aspek dari service seed akan di-clone, termasuk service itu sendiri dan konfigurasi Prometheus.<!--]--></li><li><!--[-->Koneksi telah terbentuk antara <em><!--[-->service clone<!--]--></em> dengan server monitoring. Ini adalah hasil dari langkah ke-5 dari bagian sebelumnya.<!--]--></li><li><!--[-->Koneksi antara Traefik dan service baru terbentuk. Ini adalah hasil dari langkah ke-6 dari bagian sebelumnya.<!--]--></li><!--]--></ol><h2 id="penjelasan-lanjut-cara-kerja-scale-down"><a href="#penjelasan-lanjut-cara-kerja-scale-down"><!--[-->Penjelasan Lanjut Cara Kerja Scale Down<!--]--></a></h2><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/cara-kerja-scale-down-1.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><p><!--[-->Ketika <em><!--[-->request<!--]--></em> lebih rendah, ini akan memicu pemakaian sumber daya komputasional yang sedikit. Jika terdapat dua buah server, akan menjadi tidak efisien secara biaya untuk menjalankan dua buah server yang menangani beban yang bisa ditangani oleh satu server.<!--]--></p><p><!--[-->Berikut adalah tahapan yang akan dilakukan untuk melakukan scale down:<!--]--></p><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/cara-kerja-scale-down-2.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><p><!--[-->Proses yang terjadi sama dengan event scale up. Hanya saja kita akan melakukan penghapusan terhadap server clone dan menghapus koneksi yang ada di Traefik dan server monitoring.<!--]--></p><p><!--[-->Gambar di bawah ini adalah hasil dari event scale down:<!--]--></p><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/cara-kerja-scale-down-3.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><ol><!--[--><li><!--[-->Daftar server menyisakan service seed.<!--]--></li><li><!--[-->Koneksi server clone yang lama ke monitoring server telah dihapus.<!--]--></li><li><!--[-->Koneksi server clone yang lama ke Traefik telah dihapus.<!--]--></li><!--]--></ol><h2 id="menghindari-thrashing"><a href="#menghindari-thrashing"><!--[-->Menghindari Thrashing<!--]--></a></h2><h3 id="menghindari-thrashing-karena-konfigurasi-threshold-yang-tidak-optimal"><a href="#menghindari-thrashing-karena-konfigurasi-threshold-yang-tidak-optimal"><!--[-->Menghindari Thrashing Karena Konfigurasi Threshold yang Tidak Optimal<!--]--></a></h3><p><!--[-->Dalam menentukan ambang batas (threshold) kapan sistem harus melakukan scale-up dan scale-down, kita harus menentukannya dengan cermat. Jika tidak, dapat berisiko terjadi <em><!--[-->thrashing<!--]--></em>. <em><!--[-->Thrashing<!--]--></em> adalah kondisi di mana server terus-menerus melakukan <strong><!--[-->scale-down<!--]--></strong> dan <strong><!--[-->scale-up<!--]--></strong> secara berulang tanpa henti. Kondisi ini dapat menyebabkan penggunaan sumber daya yang tidak efisien dan membebani sistem, seperti yang dijelaskan pada gambar di bawah.<!--]--></p><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/thrashing.svg" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><ol><!--[--><li><!--[-->Service clone dengan satu VM mengalami beban CPU 70%, yang melebihi ambang batas (threshold) untuk scale-up.<!--]--></li><li><!--[-->Sistem melakukan scale-up.<!--]--></li><li><!--[-->VM baru berhasil di-clone dan terhubung ke load balancer serta server monitoring.<!--]--></li><li><!--[-->Beban terbagi secara merata antara dua VM, sehingga rata-rata penggunaan CPU turun menjadi 35%, yang berada di bawah ambang batas untuk scale-down.<!--]--></li><li><!--[-->Sistem kemudian melakukan scale-down.<!--]--></li><li><!--[-->Beban CPU kembali naik ke 70%, menyebabkan sistem melakukan scale-up lagi. Kejadian ini terus berulang, menciptakan siklus yang disebut thrashing.<!--]--></li><!--]--></ol><div class="rounded-lg shadow-md overflow-hidden flex mb-4" data-v-2ca7e668><div class="bg-blue-200 w-4 min-h-full" data-v-2ca7e668></div><div class="bg-white dark:bg-gray-800" data-v-2ca7e668><div class="text-blue-200 flex items-center gap-2 px-2 py-2" data-v-2ca7e668><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="text-blue-500" data-v-2ca7e668><!--[--><!--]--><g><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm16-40a8,8,0,0,1-8,8,16,16,0,0,1-16-16V128a8,8,0,0,1,0-16,16,16,0,0,1,16,16v40A8,8,0,0,1,144,176ZM112,84a12,12,0,1,1,12,12A12,12,0,0,1,112,84Z"></path></g></svg><span class="text-xl font-bold rounded" data-v-2ca7e668>Solusi</span></div><div class="px-2" data-v-2ca7e668><!--[--><p><!--[-->Aturan yang bisa diikuti adalah mengatur threshold scale-down setengah lalu dikurang 5 persen dari threshold scale-up. Jika threshold scale-up adalah 80%, maka threshold scale-down adalah 35%.<!--]--></p><!--]--></div></div></div><h3 id="menghindari-thrashing-karena-volume-request-yang-fluktuatif"><a href="#menghindari-thrashing-karena-volume-request-yang-fluktuatif"><!--[-->Menghindari Thrashing Karena Volume Request yang Fluktuatif<!--]--></a></h3><p><!--[-->Thrashing karena volume request yang fluktuatif disebabkan jika volume request melebihi threshold secara sementara dalam waktu yang singkat, seperti yang dijelaskan pada gambar di bawah:<!--]--></p><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/graph-load-fluktuatif.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><p><!--[-->Perhatikan <em><!--[-->load<!--]--></em> sistem tiga kali berada di bawah 35%.<!--]--></p><p><!--[-->Jika pengaturan hanya menetapkan scale-down pada 35% tanpa kebijakan tambahan, maka scale-down akan terpicu meskipun beban sistem sebenarnya masih di atas threshold dalam kurun waktu menit. Hal ini dapat menyebabkan scale-down terjadi saat sistem sebenarnya belum membutuhkannya.<!--]--></p><p><!--[-->Untuk mengatasi masalah tersebut, dapat diterapkan <strong><!--[-->grace period<!--]--></strong> sebelum melakukan scale-down. Grace period ini memastikan bahwa sistem hanya melakukan scale-down jika beban tetap berada di bawah threshold selama jangka waktu tertentu, misalnya 5 menit berturut-turut.<!--]--></p><p><!--[-->Cara lain adalah menggunakan kalkulasi rata-rata beban selama 5 menit terakhir sebagai acuan untuk memicu scale-down, daripada langsung melakukan scale-down saat beban menyentuh threshold.<!--]--></p><div class="rounded-lg shadow-md overflow-hidden flex mb-4" data-v-2ca7e668><div class="bg-blue-200 w-4 min-h-full" data-v-2ca7e668></div><div class="bg-white dark:bg-gray-800" data-v-2ca7e668><div class="text-blue-200 flex items-center gap-2 px-2 py-2" data-v-2ca7e668><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="text-blue-500" data-v-2ca7e668><!--[--><!--]--><g><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm16-40a8,8,0,0,1-8,8,16,16,0,0,1-16-16V128a8,8,0,0,1,0-16,16,16,0,0,1,16,16v40A8,8,0,0,1,144,176ZM112,84a12,12,0,1,1,12,12A12,12,0,0,1,112,84Z"></path></g></svg><span class="text-xl font-bold rounded" data-v-2ca7e668>Solusi</span></div><div class="px-2" data-v-2ca7e668><!--[--><p><!--[-->Untuk mengatasi thrashing akibat volume yang fluktuatif, kita dapat menerapkan grace period yang menunggu volume request melewati threshold selama kurun waktu tertentu sebelum memicu scaling. Kita juga bisa menggunakan kalkulasi rata-rata sebagai acuan untuk memicu scaling.<!--]--></p><!--]--></div></div></div><h2 id="setup-vpc-network"><a href="#setup-vpc-network"><!--[-->Setup VPC Network<!--]--></a></h2><p><!--[-->Pembuatan VPC Network pada IDCloudHost cukup simpel.<!--]--></p><p><!--[-->Pergi ke halaman network lalu buatlah network sesuai dengan kebutuhan seperti ini.<!--]--></p><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/create-network.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><p><!--[-->Lalu pastikan network tersebut merupakan <em><!--[-->default network<!--]--></em>. Jika belum, maka klik tombol &quot;Set Default&quot; pada halaman detail network.<!--]--></p><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/set-default.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><h2 id="setup-virtual-machine"><a href="#setup-virtual-machine"><!--[-->Setup Virtual Machine<!--]--></a></h2><p><!--[-->Semua Virtual machine dibuat dengan spesifikasi berikut<!--]--></p><ul><!--[--><li><!--[-->OS: Ubuntu 22.04 lts<!--]--></li><li><!--[-->Processor: 2 VCPU<!--]--></li><li><!--[-->RAM: 2048 MB<!--]--></li><li><!--[-->Storage: 20 GB<!--]--></li><!--]--></ul><h2 id="implementasi-vm-service"><a href="#implementasi-vm-service"><!--[-->Implementasi VM Service<!--]--></a></h2><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/service-highlighted.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><p><!--[-->VM Service adalah virtual machine (VM) yang menjalankan aplikasi utama.<!--]--></p><p><!--[-->VM Service Seed adalah VM yang akan menjadi bibit yang yang menjadi template untuk VM melakukan clone<!--]--></p><p><!--[-->Didalam VM Service terdapat dua buah aplikasi yang berjalan:<!--]--></p><ol><!--[--><li><!--[-->Service atau aplikasi itu sendiri<!--]--></li><li><!--[-->Prometheus client (Node Exporter): untuk mengumpulkan data sistem (CPU Usage, Memory Usage, dll) dan mengirimkannya ke prometheus yang ada di server monitoring.<!--]--></li><!--]--></ol><p><!--[-->Pada bagian ini kita akan melakukan<!--]--></p><ol><!--[--><li><!--[-->Setup Service<!--]--></li><li><!--[-->Setup Node Exporter<!--]--></li><!--]--></ol><h3 id="aplikasi-yang-akan-dijalankan-sebagai-service"><a href="#aplikasi-yang-akan-dijalankan-sebagai-service"><!--[-->Aplikasi yang akan dijalankan sebagai service<!--]--></a></h3><p><!--[-->Service yang akan dijalankan pada Artikel ini adalah endpoint untuk melakukan hashing kriptografi (pbkdf2 dan scrypt).<!--]--></p><p><!--[-->Service ini menggunakan Node dan express yang memanfaatkan <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->worker_threads<!--]--></code> dari Node sehingga endpoint dapat menggunakan semua thread yang ada di VM.<!--]--></p><p><!--[-->Endpoint ini intensif di komputasional jadi akan memakan banyak sumber daya CPU.<!--]--></p><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>index.js</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-js shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#BB9AF7"> express</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#7AA2F7"> require</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">express</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="2"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#BB9AF7"> crypto</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#7AA2F7"> require</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">crypto</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="3"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#89DDFF"> {
</span></span><span class="line" line="4"><span style="--shiki-default:#BB9AF7">  Worker</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="5"><span style="--shiki-default:#BB9AF7">  isMainThread</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="6"><span style="--shiki-default:#BB9AF7">  parentPort</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="7"><span style="--shiki-default:#BB9AF7">  workerData</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="8"><span style="--shiki-default:#89DDFF">}</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#7AA2F7"> require</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">worker_threads</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="9"><span emptylineplaceholder="true">
</span></span><span class="line" line="10"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#BB9AF7"> app</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#7AA2F7"> express</span><span style="--shiki-default:#9ABDF5">()</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="11"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#BB9AF7"> port</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#FF9E64"> 3000</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="12"><span emptylineplaceholder="true">
</span></span><span class="line" line="13"><span style="--shiki-default:#C0CAF5">app</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">use</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">express</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">json</span><span style="--shiki-default:#9ABDF5">())</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="14"><span emptylineplaceholder="true">
</span></span><span class="line" line="15"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#7AA2F7"> performCryptoOperationsInWorker</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#E0AF68">number</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#BB9AF7"> =&gt;</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="16"><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic">  return</span><span style="--shiki-default:#89DDFF"> new</span><span style="--shiki-default:#0DB9D7"> Promise</span><span style="--shiki-default:#9ABDF5">((</span><span style="--shiki-default:#E0AF68">resolve</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#E0AF68"> reject</span><span style="--shiki-default:#9ABDF5">) </span><span style="--shiki-default:#BB9AF7">=&gt;</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="17"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">    const</span><span style="--shiki-default:#BB9AF7"> worker</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#89DDFF"> new</span><span style="--shiki-default:#7AA2F7"> Worker</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">__filename</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#9ABDF5"> { </span><span style="--shiki-default:#73DACA">workerData</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#C0CAF5"> number</span><span style="--shiki-default:#9ABDF5"> })</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="18"><span emptylineplaceholder="true">
</span></span><span class="line" line="19"><span style="--shiki-default:#C0CAF5">    worker</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">on</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">message</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#E0AF68">result</span><span style="--shiki-default:#9ABDF5">) </span><span style="--shiki-default:#BB9AF7">=&gt;</span><span style="--shiki-default:#7AA2F7"> resolve</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">result</span><span style="--shiki-default:#9ABDF5">))</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="20"><span style="--shiki-default:#C0CAF5">    worker</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">on</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">error</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#E0AF68">error</span><span style="--shiki-default:#9ABDF5">) </span><span style="--shiki-default:#BB9AF7">=&gt;</span><span style="--shiki-default:#7AA2F7"> reject</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">error</span><span style="--shiki-default:#9ABDF5">))</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="21"><span style="--shiki-default:#9ABDF5">  })</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="22"><span style="--shiki-default:#9ABDF5">}</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="23"><span emptylineplaceholder="true">
</span></span><span class="line" line="24"><span style="--shiki-default:#BB9AF7">if</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#BB9AF7">!</span><span style="--shiki-default:#C0CAF5">isMainThread</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="25"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">  const</span><span style="--shiki-default:#89DDFF"> {</span><span style="--shiki-default:#BB9AF7"> number</span><span style="--shiki-default:#89DDFF"> }</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#C0CAF5"> workerData</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="26"><span emptylineplaceholder="true">
</span></span><span class="line" line="27"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">  const</span><span style="--shiki-default:#7AA2F7"> performCryptoOperations</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#E0AF68">number</span><span style="--shiki-default:#9ABDF5">) </span><span style="--shiki-default:#BB9AF7">=&gt;</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="28"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">    const</span><span style="--shiki-default:#BB9AF7"> password</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">complex_password</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="29"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">    const</span><span style="--shiki-default:#BB9AF7"> salt</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#89DDFF"> `</span><span style="--shiki-default:#9ECE6A">unique_salt_</span><span style="--shiki-default:#7DCFFF">${</span><span style="--shiki-default:#C0CAF5">number</span><span style="--shiki-default:#7DCFFF">}</span><span style="--shiki-default:#89DDFF">`</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="30"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">    const</span><span style="--shiki-default:#BB9AF7"> iterations</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#FF9E64"> 1000</span><span style="--shiki-default:#89DDFF">;</span><span style="--shiki-default:#51597D;--shiki-default-font-style:italic"> // Sepuluh ribu - tingkatkan jika ingin beban komputasional lebih
</span></span><span class="line" line="31"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">    const</span><span style="--shiki-default:#BB9AF7"> keyLength</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#FF9E64"> 64</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="32"><span emptylineplaceholder="true">
</span></span><span class="line" line="33"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">    const</span><span style="--shiki-default:#BB9AF7"> pbkdf2Hash</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#C0CAF5"> crypto
</span></span><span class="line" line="34"><span style="--shiki-default:#89DDFF">      .</span><span style="--shiki-default:#7AA2F7">pbkdf2Sync</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">password</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#C0CAF5"> salt</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#C0CAF5"> iterations</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#C0CAF5"> keyLength</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">sha512</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5">)
</span></span><span class="line" line="35"><span style="--shiki-default:#89DDFF">      .</span><span style="--shiki-default:#7AA2F7">toString</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">hex</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="36"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">    const</span><span style="--shiki-default:#BB9AF7"> scryptHash</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#C0CAF5"> crypto
</span></span><span class="line" line="37"><span style="--shiki-default:#89DDFF">      .</span><span style="--shiki-default:#7AA2F7">scryptSync</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">password</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#C0CAF5"> salt</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#C0CAF5"> keyLength</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="38"><span style="--shiki-default:#73DACA">        N</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#FF9E64"> 2</span><span style="--shiki-default:#89DDFF"> **</span><span style="--shiki-default:#9ABDF5"> ((</span><span style="--shiki-default:#C0CAF5">number</span><span style="--shiki-default:#89DDFF"> %</span><span style="--shiki-default:#FF9E64"> 14</span><span style="--shiki-default:#9ABDF5">) </span><span style="--shiki-default:#89DDFF">+</span><span style="--shiki-default:#FF9E64"> 1</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="39"><span style="--shiki-default:#73DACA">        r</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#FF9E64"> 8</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="40"><span style="--shiki-default:#73DACA">        p</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#FF9E64"> 1</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="41"><span style="--shiki-default:#9ABDF5">      })
</span></span><span class="line" line="42"><span style="--shiki-default:#89DDFF">      .</span><span style="--shiki-default:#7AA2F7">toString</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">hex</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="43"><span emptylineplaceholder="true">
</span></span><span class="line" line="44"><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic">    return</span><span style="--shiki-default:#9ABDF5"> { </span><span style="--shiki-default:#C0CAF5">pbkdf2Hash</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#C0CAF5"> scryptHash</span><span style="--shiki-default:#9ABDF5"> }</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="45"><span style="--shiki-default:#9ABDF5">  }</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="46"><span emptylineplaceholder="true">
</span></span><span class="line" line="47"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">  const</span><span style="--shiki-default:#BB9AF7"> result</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#7AA2F7"> performCryptoOperations</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">workerData</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="48"><span style="--shiki-default:#C0CAF5">  parentPort</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">postMessage</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">result</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="49"><span style="--shiki-default:#9ABDF5">}</span><span style="--shiki-default:#BB9AF7"> else</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="50"><span style="--shiki-default:#C0CAF5">  app</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">post</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">/calculate</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic"> async</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#E0AF68">req</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#E0AF68"> res</span><span style="--shiki-default:#9ABDF5">) </span><span style="--shiki-default:#BB9AF7">=&gt;</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="51"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">    const</span><span style="--shiki-default:#89DDFF"> {</span><span style="--shiki-default:#BB9AF7"> number</span><span style="--shiki-default:#89DDFF"> }</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#C0CAF5"> req</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7DCFFF">body</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="52"><span emptylineplaceholder="true">
</span></span><span class="line" line="53"><span style="--shiki-default:#BB9AF7">    if</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#89DDFF">typeof</span><span style="--shiki-default:#C0CAF5"> number</span><span style="--shiki-default:#BB9AF7"> !==</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">number</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#BB9AF7"> ||</span><span style="--shiki-default:#C0CAF5"> number</span><span style="--shiki-default:#BB9AF7"> &lt;=</span><span style="--shiki-default:#FF9E64"> 0</span><span style="--shiki-default:#9ABDF5">) {
</span></span><span class="line" line="54"><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic">      return</span><span style="--shiki-default:#C0CAF5"> res</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">status</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#FF9E64">400</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">json</span><span style="--shiki-default:#9ABDF5">({ </span><span style="--shiki-default:#73DACA">error</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">Input harus bilangan positif</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5"> })</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="55"><span style="--shiki-default:#9ABDF5">    }
</span></span><span class="line" line="56"><span emptylineplaceholder="true">
</span></span><span class="line" line="57"><span style="--shiki-default:#BB9AF7">    try</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="58"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">      const</span><span style="--shiki-default:#BB9AF7"> result</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic"> await</span><span style="--shiki-default:#7AA2F7"> performCryptoOperationsInWorker</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">number</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="59"><span style="--shiki-default:#C0CAF5">      res</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">json</span><span style="--shiki-default:#9ABDF5">({
</span></span><span class="line" line="60"><span style="--shiki-default:#73DACA">        input</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#C0CAF5"> number</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="61"><span style="--shiki-default:#F7768E;--shiki-default-font-weight:bold">        ...</span><span style="--shiki-default:#C0CAF5">result</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="62"><span style="--shiki-default:#9ABDF5">      })</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="63"><span style="--shiki-default:#9ABDF5">    } </span><span style="--shiki-default:#BB9AF7">catch</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#C0CAF5">error</span><span style="--shiki-default:#9ABDF5">) {
</span></span><span class="line" line="64"><span style="--shiki-default:#C0CAF5">      res
</span></span><span class="line" line="65"><span style="--shiki-default:#89DDFF">        .</span><span style="--shiki-default:#7AA2F7">status</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#FF9E64">500</span><span style="--shiki-default:#9ABDF5">)
</span></span><span class="line" line="66"><span style="--shiki-default:#89DDFF">        .</span><span style="--shiki-default:#7AA2F7">json</span><span style="--shiki-default:#9ABDF5">({ </span><span style="--shiki-default:#73DACA">error</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">An error occurred while processing the request</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5"> })</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="67"><span style="--shiki-default:#9ABDF5">    }
</span></span><span class="line" line="68"><span style="--shiki-default:#9ABDF5">  })</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="69"><span emptylineplaceholder="true">
</span></span><span class="line" line="70"><span style="--shiki-default:#C0CAF5">  app</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">listen</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">port</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#9ABDF5"> () </span><span style="--shiki-default:#BB9AF7">=&gt;</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="71"><span style="--shiki-default:#C0CAF5">    console</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">log</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">`</span><span style="--shiki-default:#9ECE6A">Server running at http://localhost:</span><span style="--shiki-default:#7DCFFF">${</span><span style="--shiki-default:#C0CAF5">port</span><span style="--shiki-default:#7DCFFF">}</span><span style="--shiki-default:#89DDFF">`</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="72"><span style="--shiki-default:#9ABDF5">  })</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="73"><span style="--shiki-default:#9ABDF5">}
</span></span></code><!--]--></pre></div><h3 id="prometheus-client-node-exporter"><a href="#prometheus-client-node-exporter"><!--[-->Prometheus Client (Node Exporter)<!--]--></a></h3><p><!--[-->Berikut adalah tahapan untuk menginstall dan mengkonfigurasi Node Exporter:<!--]--></p><ol><!--[--><li><!--[-->Lihat halaman ini <a href="https://prometheus.io/download/#node_exporter" rel="nofollow"><!--[-->https://prometheus.io/download/#node_exporter<!--]--></a> untuk mengetahui versi terbaru dari Node Exporter<!--]--></li><li><!--[-->Instal versi terbaru Node Exporter menggunakan <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->wget<!--]--></code><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">wget</span><span style="--shiki-default:#9ECE6A"> https://github.com/prometheus/node_exporter/releases/download/v1.8.2/node_exporter-1.8.2.linux-amd64.tar.gz
</span></span></code><!--]--></pre></div><br>Cukup ganti <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->1.8.2<!--]--></code> dengan versi terbaru<!--]--></li><li><!--[-->Ekstrak aplikasi.<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">tar</span><span style="--shiki-default:#9ECE6A"> xvfz</span><span style="--shiki-default:#9ECE6A"> node_exporter-</span><span style="--shiki-default:#F7768E">*</span><span style="--shiki-default:#9ECE6A">.tar.gz
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Pindahkan executable <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->node_exporter<!--]--></code> kedalam folder<code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->usr/local/bin<!--]--></code>sehingga bisa diakses seluruh sistem<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> mv</span><span style="--shiki-default:#9ECE6A"> node_exporter-1.8.2.linux-amd64/node_exporter</span><span style="--shiki-default:#9ECE6A"> /usr/local/bin
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->(<strong><!--[-->Opsional<!--]--></strong>) Hapus sisa file<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">rm</span><span style="--shiki-default:#E0AF68"> -r</span><span style="--shiki-default:#9ECE6A"> node_exporter-1.8.2.linux-amd64</span><span style="--shiki-default:#F7768E">*
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Jalankan command berikut untuk melihat status instalasi node_exporter<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">node_exporter
</span></span></code><!--]--></pre></div><br>Node Exporter berhasil diinstal jika muncul pesan seperti ini<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md"><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><!----></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="overflow-auto p-3"><!--[--><code>ts=2024-10-22T12:55:16.946Z caller=node_exporter.go:193 level=info msg=&quot;Starting node_exporter&quot; version=&quot;(version=1.8.2, branch=HEAD, revision=f1e0e8360aa60b6cb5e5cc1560bed348fc2c1895)&quot;
Dan seterusnya ...
</code><!--]--></pre></div><!--]--></li><!--]--></ol><h4 id="menjalankan-node-exporter-sebagai-systemd"><a href="#menjalankan-node-exporter-sebagai-systemd"><!--[-->Menjalankan Node Exporter sebagai <em><!--[-->systemd<!--]--></em><!--]--></a></h4><p><!--[-->Node Exporter telah berhasil diinstal, dan sudah dapat dijalankan. Namun, untuk memastikan Node Exporter otomatis berjalan saat server dinyalakan, Node Exporter perlu dijalankan sebagai <em><!--[-->system service<!--]--></em>. Dengan begitu, ketika server di-clone, Node Exporter akan langsung aktif tanpa perlu dimulai secara manual.<!--]--></p><ol><!--[--><li><!--[-->Pertama buatlah user untuk node exporter<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> useradd</span><span style="--shiki-default:#E0AF68"> -rs</span><span style="--shiki-default:#9ECE6A"> /bin/</span><span style="--shiki-default:#FF9E64">false</span><span style="--shiki-default:#9ECE6A"> node_exporter
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Buatlah service file yang akan digunakan oleh <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->systemctl<!--]--></code>. File harus bernama<code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->node_exporter.service<!--]--></code><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> nano</span><span style="--shiki-default:#9ECE6A"> /etc/systemd/system/node_exporter.service
</span></span></code><!--]--></pre></div><br>Isi dari file adalah sebagai berikut:<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md"><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>/etc/systemd/system/node_exporter.service</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="overflow-auto p-3"><!--[--><code>[Unit]
Description=Node Exporter
Wants=network-online.target
After=network-online.target

[Service]
User=node_exporter
Group=node_exporter
Type=simple
Restart=on-failure
RestartSec=5s
ExecStart=/usr/local/bin/node_exporter

[Install]
WantedBy=multi-user.target
</code><!--]--></pre></div><!--]--></li><li><!--[-->Untuk menjalankan Node Exporter secara otomatis ketika server dimulai (boot time), jalankan command <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->systemctl enable<!--]--></code><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> systemctl</span><span style="--shiki-default:#9ECE6A"> enable</span><span style="--shiki-default:#9ECE6A"> node_exporter
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Reload <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->systemctl<!--]--></code>daemon, Mulai node_exporter dan cek statusnya<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> systemctl</span><span style="--shiki-default:#9ECE6A"> daemon-reload
</span></span><span class="line" line="2"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> systemctl</span><span style="--shiki-default:#9ECE6A"> start</span><span style="--shiki-default:#9ECE6A"> node_exporter
</span></span><span class="line" line="3"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> systemctl</span><span style="--shiki-default:#9ECE6A"> status</span><span style="--shiki-default:#9ECE6A"> node_exporter
</span></span></code><!--]--></pre></div><br>Jika Node Exporter telah aktif maka akan mengeluarkan pesan seperti ini:<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">node_exporter.service</span><span style="--shiki-default:#9ECE6A"> -</span><span style="--shiki-default:#9ECE6A"> Node</span><span style="--shiki-default:#9ECE6A"> Exporter
</span></span><span class="line" line="2"><span style="--shiki-default:#C0CAF5">Loaded:</span><span style="--shiki-default:#9ECE6A"> loaded</span><span style="--shiki-default:#A9B1D6"> (/etc/systemd/system/node_exporter.service</span><span style="--shiki-default:#89DDFF">;</span><span style="--shiki-default:#C0CAF5"> enabled</span><span style="--shiki-default:#89DDFF">;</span><span style="--shiki-default:#C0CAF5"> vendor</span><span style="--shiki-default:#9ECE6A"> preset:</span><span style="--shiki-default:#9ECE6A"> enabled</span><span style="--shiki-default:#A9B1D6">)
</span></span><span class="line" line="3"><span style="--shiki-default:#C0CAF5">Active:</span><span style="--shiki-default:#9ECE6A"> active</span><span style="--shiki-default:#A9B1D6"> (running) since Tue 2023-04-11 13:48:06 UTC</span><span style="--shiki-default:#89DDFF">;</span><span style="--shiki-default:#C0CAF5"> 4s</span><span style="--shiki-default:#9ECE6A"> ago
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Cek url <a href="http://localhost:9100/metrics" rel="nofollow"><!--[-->http://localhost:9100/metrics<!--]--></a> untuk melihat apakah node exporter sudah berjalan<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">curl</span><span style="--shiki-default:#9ECE6A"> http://localhost:9100/metrics
</span></span></code><!--]--></pre></div><!--]--></li><!--]--></ol><h2 id="implementasi-server-traefik-api-gateway-dan-load-balancer"><a href="#implementasi-server-traefik-api-gateway-dan-load-balancer"><!--[-->Implementasi Server Traefik API Gateway dan Load Balancer<!--]--></a></h2><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/traefik-highlighted.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><p><!--[-->Terdapat dua aplikasi yang berjalan pada server ini yaitu Traefik dan API Target Updater<!--]--></p><p><!--[-->Traefik akan digunakan sebagai load balancer dan API target updater adalah endpoint yang akan mengupdate daftar server yang terhubung ke Traefik. API target updater akan digunakan oleh webhook handler pada server monitoring setelah ada server yang berhasil ditambah atau dihapus.<!--]--></p><p><!--[-->Bagian ini akan menjelaskan tentang:<!--]--></p><ol><!--[--><li><!--[-->Instalasi dan konfigurasi Traefik<!--]--></li><li><!--[-->Pembuatan API target updater berupa server Express<!--]--></li><!--]--></ol><h3 id="instalasi-traefik"><a href="#instalasi-traefik"><!--[-->Instalasi Traefik<!--]--></a></h3><ol><!--[--><li><!--[-->Install Traefik binary<br>cek versi traefik terbaru di <a href="https://github.com/traefik/traefik/releases" rel="nofollow"><!--[-->https://github.com/traefik/traefik/releases<!--]--></a><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5"> wget</span><span style="--shiki-default:#9ECE6A"> https://github.com/traefik/traefik/releases/download/v3.1.4/traefik_v3.1.4_linux_amd64.tar.gz
</span></span></code><!--]--></pre></div><br>Ganti v3.1.4 dengan versi terbaru<!--]--></li><li><!--[-->Ekstrak file Traefik<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">tar</span><span style="--shiki-default:#E0AF68"> -zxvf</span><span style="--shiki-default:#9ECE6A"> traefik_v3.1.4_linux_amd64.tar.gz
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Pindahkan file bernama &#39;traefik&#39; ke usr/local/bin<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> mv</span><span style="--shiki-default:#9ECE6A"> traefik</span><span style="--shiki-default:#9ECE6A"> /usr/local/bin
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Cek status instalasi Traefik<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">traefik</span><span style="--shiki-default:#E0AF68"> --help
</span></span></code><!--]--></pre></div><!--]--></li><!--]--></ol><h3 id="menulis-file-konfigurasi-untuk-traefik"><a href="#menulis-file-konfigurasi-untuk-traefik"><!--[-->Menulis File Konfigurasi Untuk Traefik<!--]--></a></h3><p><!--[-->Pada bagian ini kita akan membuat file konfigurasi yang diperlukan untuk menjalankan Traefik<!--]--></p><p><!--[-->Berikut cara kerjanya<!--]--></p><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/traefik-file.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><ol><!--[--><li><!--[--><code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->static.yml<!--]--></code>, berisi konfigurasi dasar yaitu entrypoints, dan letak file konfigurasi<!--]--></li><li><!--[--><code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->configs/dynamic.yaml<!--]--></code>, berisikan endpoint yang akan diekspos ke publik dan server apa yang menangani endpoint tersebut dan pengaturan lain.<!--]--></li><li><!--[--><code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->configs/services.yaml<!--]--></code>, beriskan daftar server yang terhubung dengan Traefik.<!--]--></li><!--]--></ol><p><!--[-->File <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->static.yml<!--]--></code> akan digunakan oleh Traefik sebagai file konfigurasi utama. Lalu file ini akan terhubung dengan folder <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->configs<!--]--></code> yang berisikan dua buah file konfigurasi dinamis yaitu <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->dynamic.yaml<!--]--></code> dan <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->services.yaml<!--]--></code>. Kegunaaan dari setiap file akan dijelaskan pada bagiannya masing-masing.<!--]--></p><ol><!--[--><li><!--[-->Buat folder configs<!--]--></li><!--]--></ol><p><!--[-->Buatlah folder traefik didalam folder <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->/etc<!--]--></code>, folder ini akan menjadi wadah file konfigurasi yang akan digunakan traefik.<!--]--></p><p><!--[-->semua file yang berkaitan dengan Traefik akan diletakan disini.<!--]--></p><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> mkdir</span><span style="--shiki-default:#9ECE6A"> /etc/traefik
</span></span></code><!--]--></pre></div><ol start="2"><!--[--><li><!--[-->Pembuatan File <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->/etc/traefik/static.yaml<!--]--></code><!--]--></li><!--]--></ol><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> nano</span><span style="--shiki-default:#9ECE6A"> /etc/traefik/static.yaml
</span></span></code><!--]--></pre></div><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>/etc/traefik/static.yaml</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-yaml shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#F7768E">entryPoints</span><span style="--shiki-default:#89DDFF">:
</span></span><span class="line" line="2"><span style="--shiki-default:#F7768E">  web</span><span style="--shiki-default:#89DDFF">:
</span></span><span class="line" line="3"><span style="--shiki-default:#F7768E">    address</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">:80</span><span style="--shiki-default:#89DDFF">&quot;
</span></span><span class="line" line="4"><span emptylineplaceholder="true">
</span></span><span class="line" line="5"><span style="--shiki-default:#F7768E">providers</span><span style="--shiki-default:#89DDFF">:
</span></span><span class="line" line="6"><span style="--shiki-default:#F7768E">  file</span><span style="--shiki-default:#89DDFF">:
</span></span><span class="line" line="7"><span style="--shiki-default:#F7768E">    directory</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#9ECE6A"> /etc/traefik/configs
</span></span><span class="line" line="8"><span style="--shiki-default:#F7768E">    watch</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#FF9E64"> true
</span></span></code><!--]--></pre></div><p><!--[-->Diatas adalah konfigurasi minimal yang digunakan untuk menjalankan Traefik dengan file provider.
Konfigurasi ini mendefinisikan <strong><!--[-->entryPoint<!--]--></strong> bernama <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->web<!--]--></code> pada port <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->80<!--]--></code>, Karena yagn diekspos adalah port 80 artinya Traefik akan menerima <em><!--[-->request<!--]--></em> berjenis http.<!--]--></p><p><!--[-->Bagian <strong><!--[-->providers<!--]--></strong> menunjukan letak tempat file konfigurasi disimpan.
Opsi <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->watch: true<!--]--></code> memungkinkan Traefik untuk secara otomatis memantau perubahan pada file konfigurasi di direktori tersebut dan menerapkan pembaruan tanpa memerlukan restart.<!--]--></p><ol start="2"><!--[--><li><!--[-->Pembuatan File Dynamic config <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->/etc/traefik/configs/dynamic.yaml<!--]--></code><!--]--></li><!--]--></ol><p><!--[-->Buat folder configs untuk menampung file konfigurasi dinamis yang akan digunakan file konfigurasi.<!--]--></p><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> mkdir</span><span style="--shiki-default:#9ECE6A"> /etc/traefik/configs
</span></span></code><!--]--></pre></div><p><!--[-->Buat file konfigurasi <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->dynamic.yaml<!--]--></code><!--]--></p><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> nano</span><span style="--shiki-default:#9ECE6A"> /etc/traefik/configs/dynamic.yaml
</span></span></code><!--]--></pre></div><p><!--[-->Isi dengan kode berikut:<!--]--></p><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><!----></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-yaml shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#F7768E">http</span><span style="--shiki-default:#89DDFF">:
</span></span><span class="line" line="2"><span style="--shiki-default:#F7768E">  routers</span><span style="--shiki-default:#89DDFF">:
</span></span><span class="line" line="3"><span style="--shiki-default:#F7768E">    calculate</span><span style="--shiki-default:#89DDFF">:
</span></span><span class="line" line="4"><span style="--shiki-default:#F7768E">      entrypoints</span><span style="--shiki-default:#89DDFF">:
</span></span><span class="line" line="5"><span style="--shiki-default:#9ABDF5">        -</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">web</span><span style="--shiki-default:#89DDFF">&quot;
</span></span><span class="line" line="6"><span style="--shiki-default:#F7768E">      rule</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">Path(`/calculate`)</span><span style="--shiki-default:#89DDFF">&quot;
</span></span><span class="line" line="7"><span style="--shiki-default:#F7768E">      service</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">calculate</span><span style="--shiki-default:#89DDFF">&quot;
</span></span></code><!--]--></pre></div><p><!--[-->Kode diatas mendefinisikan sebuah router untuk menangani permintaan HTTP ke path /calculate. Penjelasan singkatnya:<!--]--></p><ul><!--[--><li><!--[-->routers.calculate: Mendefinisikan router bernama calculate.<!--]--></li><li><!--[-->entrypoints: Menunjukkan bahwa router ini akan menangani request yang masuk melalui entrypoint web (port 80 untuk HTTP).<!--]--></li><li><!--[-->rule dan service: service calculate akan dijalankan ketika user melakukan request ke <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->/calculate<!--]--></code><!--]--></li><!--]--></ul><ol start="3"><!--[--><li><!--[-->Pembuatan File Services config <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->/etc/traefik/configs/services.yaml<!--]--></code><!--]--></li><!--]--></ol><p><!--[-->File ini mendifinisikan apa itu service <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->calculate<!--]--></code>.<!--]--></p><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> nano</span><span style="--shiki-default:#9ECE6A"> /etc/traefik/configs/services.yaml
</span></span></code><!--]--></pre></div><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><!----></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-yaml shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#F7768E">http</span><span style="--shiki-default:#89DDFF">:
</span></span><span class="line" line="2"><span style="--shiki-default:#F7768E">  services</span><span style="--shiki-default:#89DDFF">:
</span></span><span class="line" line="3"><span style="--shiki-default:#F7768E">    calculate</span><span style="--shiki-default:#89DDFF">:
</span></span><span class="line" line="4"><span style="--shiki-default:#F7768E">      loadBalancer</span><span style="--shiki-default:#89DDFF">:
</span></span><span class="line" line="5"><span style="--shiki-default:#F7768E">        servers</span><span style="--shiki-default:#89DDFF">:
</span></span><span class="line" line="6"><span style="--shiki-default:#9ABDF5">          -</span><span style="--shiki-default:#F7768E"> url</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">http://&lt;private-ip-services&gt;:3000/</span><span style="--shiki-default:#89DDFF">&quot;
</span></span><span class="line" line="7"><span style="--shiki-default:#9ABDF5">          -</span><span style="--shiki-default:#F7768E"> url</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">http://&lt;private-ip-services&gt;:3000/</span><span style="--shiki-default:#89DDFF">&quot;
</span></span></code><!--]--></pre></div><ul><!--[--><li><!--[--><code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->services.calculate<!--]--></code>: Mendefinisikan sebuah service bernama <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->calculate<!--]--></code>.<!--]--></li><li><!--[--><code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->loadBalancer<!--]--></code>: Menggunakan load balancer untuk mendistribusikan permintaan ke daftar server yang ada di bagian <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->servers<!--]--></code>.<!--]--></li><li><!--[--><code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->servers<!--]--></code>: Mendefinisikan daftar url server backend yang akan menerima permintaan.<!--]--></li><li><!--[--><code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->url<!--]--></code>: Menunjukkan URL milik server service.<!--]--></li><!--]--></ul><p><!--[-->Request akan didistribusikan kepada daftar Url dengan metode round robin<!--]--></p><p><!--[-->File ini akan diupdate setiap kali event scaling terjadi, untuk itu buka akses <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->read<!--]--></code> dan <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->write<!--]--></code> pada file ini sehingga daftar url bisa diupdate secara otomatis oleh sistem.<!--]--></p><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> chmod</span><span style="--shiki-default:#9ECE6A"> +rw</span><span style="--shiki-default:#9ECE6A"> /etc/traefik/configs/services.yaml
</span></span></code><!--]--></pre></div><h3 id="menjalankan-traefik-dengan-systemd"><a href="#menjalankan-traefik-dengan-systemd"><!--[-->Menjalankan Traefik dengan systemd<!--]--></a></h3><p><!--[-->Aplikasi akan dijalankan dengan systemd untuk memanfaatkan fitur startup otomatis saat reboot.<!--]--></p><p><!--[-->Pertama buatlah user Traefik:<!--]--></p><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> useradd</span><span style="--shiki-default:#E0AF68"> -rs</span><span style="--shiki-default:#9ECE6A"> /bin/</span><span style="--shiki-default:#FF9E64">false</span><span style="--shiki-default:#9ECE6A"> traefik
</span></span></code><!--]--></pre></div><p><!--[-->Ubah izin file Traefik agar bisa dieksekusi oleh user Traefik.<!--]--></p><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> chmod</span><span style="--shiki-default:#FF9E64"> 755</span><span style="--shiki-default:#9ECE6A"> /usr/local/bin/traefik
</span></span></code><!--]--></pre></div><p><!--[-->Berikan izin kepada traefik untuk menggunakan ports yang &quot;privileged&quot; (80, 443) sebagai non-root user<!--]--></p><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> setcap</span><span style="--shiki-default:#89DDFF"> &#39;</span><span style="--shiki-default:#9ECE6A">cap_net_bind_service=+ep</span><span style="--shiki-default:#89DDFF">&#39;</span><span style="--shiki-default:#9ECE6A"> /usr/local/bin/traefik
</span></span></code><!--]--></pre></div><p><!--[-->Lalu buat file service:<!--]--></p><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> nano</span><span style="--shiki-default:#9ECE6A"> /etc/systemd/system/traefik.service
</span></span></code><!--]--></pre></div><p><!--[-->Berikut isinya<!--]--></p><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md"><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><!----></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="overflow-auto p-3"><!--[--><code>[Unit]
Description=Traefik
Wants=network-online.target
After=network-online.target

[Service]
ExecStart=/usr/local/bin/traefik --configFile=/etc/traefik/static.yaml
User=traefik
Group=traefik
Restart=on-failure
RestartSec=5s

[Install]
WantedBy=multi-user.target
</code><!--]--></pre></div><p><!--[-->Enable service traefik sehingga dapat mulai secara otomatis jika vm reboot<!--]--></p><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> systemctl</span><span style="--shiki-default:#9ECE6A"> enable</span><span style="--shiki-default:#9ECE6A"> traefik
</span></span></code><!--]--></pre></div><p><!--[-->Reload daemon, mulai traefik dan cek status:<!--]--></p><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> systemctl</span><span style="--shiki-default:#9ECE6A"> daemon-reload
</span></span><span class="line" line="2"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> systemctl</span><span style="--shiki-default:#9ECE6A"> start</span><span style="--shiki-default:#9ECE6A"> traefik
</span></span><span class="line" line="3"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> systemctl</span><span style="--shiki-default:#9ECE6A"> status</span><span style="--shiki-default:#9ECE6A"> traefik
</span></span></code><!--]--></pre></div><h3 id="pembuatan-target-updater"><a href="#pembuatan-target-updater"><!--[-->Pembuatan Target Updater<!--]--></a></h3><p><!--[-->Bagian ini akan memberikan arahan cara membuat sebuah server node menggunakan express untuk menangangi event scale down dan event scale up<!--]--></p><p><!--[-->Tugas dari sistem ini adalah untuk melakukan update ke file <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->/etc/traefik/config/services.yaml<!--]--></code> untuk memperbarui daftar server pada <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->loadBalancer.servers<!--]--></code>.<!--]--></p><h4 id="pembuatan-service-express-untuk-menerima-daftar-server-terbaru"><a href="#pembuatan-service-express-untuk-menerima-daftar-server-terbaru"><!--[-->Pembuatan service express untuk menerima daftar server terbaru<!--]--></a></h4><ol><!--[--><li><!--[-->Install Node<br>Berikut adalah langkah-langkah menginstall Node v20 pada Linux menggunakan nvm diambil dari <a href="https://nodejs.org/en/download/package-manager" rel="nofollow"><!--[-->website resmi Node<!--]--></a><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">curl</span><span style="--shiki-default:#E0AF68"> -o-</span><span style="--shiki-default:#9ECE6A"> https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.0/install.sh</span><span style="--shiki-default:#89DDFF"> |</span><span style="--shiki-default:#C0CAF5"> bash
</span></span><span class="line" line="2"><span emptylineplaceholder="true">
</span></span><span class="line" line="3"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">##### REFRESH TERMINAL #####
</span></span><span class="line" line="4"><span emptylineplaceholder="true">
</span></span><span class="line" line="5"><span style="--shiki-default:#C0CAF5">nvm</span><span style="--shiki-default:#9ECE6A"> install</span><span style="--shiki-default:#FF9E64"> 20
</span></span><span class="line" line="6"><span emptylineplaceholder="true">
</span></span><span class="line" line="7"><span style="--shiki-default:#C0CAF5">node</span><span style="--shiki-default:#E0AF68"> -v
</span></span><span class="line" line="8"><span emptylineplaceholder="true">
</span></span><span class="line" line="9"><span style="--shiki-default:#C0CAF5">npm</span><span style="--shiki-default:#E0AF68"> -v
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Inisiasi Folder API<br>Buat sebuah folder untuk API yang akan dibuat, pada artikel ini folder tersebut akan diberi nama <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->server-list-updater<!--]--></code><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">mkdir</span><span style="--shiki-default:#9ECE6A"> server-list-updater
</span></span><span class="line" line="2"><span style="--shiki-default:#0DB9D7">cd</span><span style="--shiki-default:#9ECE6A"> server-list-updater
</span></span><span class="line" line="3"><span emptylineplaceholder="true">
</span></span><span class="line" line="4"><span style="--shiki-default:#C0CAF5">npm</span><span style="--shiki-default:#9ECE6A"> init</span><span style="--shiki-default:#E0AF68"> -y
</span></span><span class="line" line="5"><span style="--shiki-default:#C0CAF5">npm</span><span style="--shiki-default:#9ECE6A"> install</span><span style="--shiki-default:#9ECE6A"> express
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Pembuatan Endpoint
Buatlah file <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->index.js<!--]--></code><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">touch</span><span style="--shiki-default:#9ECE6A"> index.js
</span></span></code><!--]--></pre></div><br>Lalu tulis kode berikut:<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><!----></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-js shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#BB9AF7"> express</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#7AA2F7"> require</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">express</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="2"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#BB9AF7"> fs</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#7AA2F7"> require</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">fs</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="3"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#BB9AF7"> path</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#7AA2F7"> require</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">path</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="4"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#BB9AF7"> YAML</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#7AA2F7"> require</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">yaml</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;</span><span style="--shiki-default:#51597D;--shiki-default-font-style:italic"> // Library untuk mengonversi objek JavaScript ke format YAML
</span></span><span class="line" line="5"><span emptylineplaceholder="true">
</span></span><span class="line" line="6"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#BB9AF7"> app</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#7AA2F7"> express</span><span style="--shiki-default:#9ABDF5">()</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="7"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#BB9AF7"> PORT</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#FF9E64"> 3000</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="8"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#BB9AF7"> servicesFilePath</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">/etc/traefik/configs/services.yaml</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="9"><span emptylineplaceholder="true">
</span></span><span class="line" line="10"><span style="--shiki-default:#C0CAF5">app</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">use</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">express</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">json</span><span style="--shiki-default:#9ABDF5">())</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="11"><span emptylineplaceholder="true">
</span></span><span class="line" line="12"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">// Endpoint untuk memperbarui daftar server pada file services.yaml
</span></span><span class="line" line="13"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">// Endpoint menerima parameter berupa array of string yang berisi daftar url services terbaru
</span></span><span class="line" line="14"><span style="--shiki-default:#C0CAF5">app</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">post</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">/update-servers</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#E0AF68">req</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#E0AF68"> res</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#BB9AF7"> =&gt;</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="15"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">  const</span><span style="--shiki-default:#89DDFF"> {</span><span style="--shiki-default:#BB9AF7"> servers</span><span style="--shiki-default:#89DDFF"> }</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#C0CAF5"> req</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7DCFFF">body</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="16"><span emptylineplaceholder="true">
</span></span><span class="line" line="17"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">  // Validasi input: Pastikan &#39;servers&#39; adalah array yang tidak kosong
</span></span><span class="line" line="18"><span style="--shiki-default:#BB9AF7">  if</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#BB9AF7">!</span><span style="--shiki-default:#C0CAF5">servers</span><span style="--shiki-default:#BB9AF7"> ||</span><span style="--shiki-default:#BB9AF7"> !</span><span style="--shiki-default:#C0CAF5">Array</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">isArray</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">servers</span><span style="--shiki-default:#9ABDF5">) </span><span style="--shiki-default:#BB9AF7">||</span><span style="--shiki-default:#C0CAF5"> servers</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7DCFFF">length</span><span style="--shiki-default:#BB9AF7"> ===</span><span style="--shiki-default:#FF9E64"> 0</span><span style="--shiki-default:#9ABDF5">) {
</span></span><span class="line" line="19"><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic">    return</span><span style="--shiki-default:#C0CAF5"> res</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">status</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#FF9E64">400</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">json</span><span style="--shiki-default:#9ABDF5">({
</span></span><span class="line" line="20"><span style="--shiki-default:#73DACA">      message</span><span style="--shiki-default:#89DDFF">:
</span></span><span class="line" line="21"><span style="--shiki-default:#89DDFF">        &quot;</span><span style="--shiki-default:#9ECE6A">Invalid request body. Expected a non-empty array of servers.</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="22"><span style="--shiki-default:#9ABDF5">    })</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="23"><span style="--shiki-default:#9ABDF5">  }
</span></span><span class="line" line="24"><span emptylineplaceholder="true">
</span></span><span class="line" line="25"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">  // Struktur data YAML yang akan ditulis ke file services.yaml
</span></span><span class="line" line="26"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">  // Object ini akan diubah oleh library YAML ke bentuk string yaml
</span></span><span class="line" line="27"><span emptylineplaceholder="true">
</span></span><span class="line" line="28"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">  const</span><span style="--shiki-default:#BB9AF7"> servicesYamlContent</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="29"><span style="--shiki-default:#73DACA">    http</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="30"><span style="--shiki-default:#73DACA">      services</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="31"><span style="--shiki-default:#41A6B5">        mathCalculate</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="32"><span style="--shiki-default:#41A6B5">          loadBalancer</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="33"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">            // mengisi daftar url dengan url terbaru yang didapat dari body
</span></span><span class="line" line="34"><span style="--shiki-default:#41A6B5">            servers</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#C0CAF5"> servers</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">map</span><span style="--shiki-default:#9ABDF5">((</span><span style="--shiki-default:#E0AF68">url</span><span style="--shiki-default:#9ABDF5">) </span><span style="--shiki-default:#BB9AF7">=&gt;</span><span style="--shiki-default:#9ABDF5"> ({ </span><span style="--shiki-default:#C0CAF5">url</span><span style="--shiki-default:#9ABDF5"> }))</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="35"><span style="--shiki-default:#9ABDF5">          }</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="36"><span style="--shiki-default:#9ABDF5">        }</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="37"><span style="--shiki-default:#9ABDF5">      }</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="38"><span style="--shiki-default:#9ABDF5">    }</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="39"><span style="--shiki-default:#9ABDF5">  }</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="40"><span emptylineplaceholder="true">
</span></span><span class="line" line="41"><span style="--shiki-default:#BB9AF7">  try</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="42"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">    // mengubah object javascript ke string yaml
</span></span><span class="line" line="43"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">    const</span><span style="--shiki-default:#BB9AF7"> yamlString</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#0DB9D7"> YAML</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">stringify</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">servicesYamlContent</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="44"><span style="--shiki-default:#C0CAF5">    fs</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">writeFileSync</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">servicesFilePath</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#C0CAF5"> yamlString</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="45"><span emptylineplaceholder="true">
</span></span><span class="line" line="46"><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic">    return</span><span style="--shiki-default:#C0CAF5"> res
</span></span><span class="line" line="47"><span style="--shiki-default:#89DDFF">      .</span><span style="--shiki-default:#7AA2F7">status</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#FF9E64">200</span><span style="--shiki-default:#9ABDF5">)
</span></span><span class="line" line="48"><span style="--shiki-default:#89DDFF">      .</span><span style="--shiki-default:#7AA2F7">json</span><span style="--shiki-default:#9ABDF5">({ </span><span style="--shiki-default:#73DACA">message</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">services.yaml updated successfully</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5"> })</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="49"><span style="--shiki-default:#9ABDF5">  } </span><span style="--shiki-default:#BB9AF7">catch</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#C0CAF5">error</span><span style="--shiki-default:#9ABDF5">) {
</span></span><span class="line" line="50"><span style="--shiki-default:#C0CAF5">    console</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">error</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">Error writing services.yaml file:</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#C0CAF5"> error</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="51"><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic">    return</span><span style="--shiki-default:#C0CAF5"> res</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">status</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#FF9E64">500</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">json</span><span style="--shiki-default:#9ABDF5">({
</span></span><span class="line" line="52"><span style="--shiki-default:#73DACA">      message</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">Failed to update services.yaml</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="53"><span style="--shiki-default:#73DACA">      error</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#C0CAF5"> error</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7DCFFF">message</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="54"><span style="--shiki-default:#9ABDF5">    })</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="55"><span style="--shiki-default:#9ABDF5">  }
</span></span><span class="line" line="56"><span style="--shiki-default:#9ABDF5">})</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="57"><span emptylineplaceholder="true">
</span></span><span class="line" line="58"><span style="--shiki-default:#C0CAF5">app</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">listen</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#FF9E64">PORT</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#9ABDF5"> ()</span><span style="--shiki-default:#BB9AF7"> =&gt;</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="59"><span style="--shiki-default:#C0CAF5">  console</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">log</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">`</span><span style="--shiki-default:#9ECE6A">Server is running on port </span><span style="--shiki-default:#7DCFFF">${</span><span style="--shiki-default:#FF9E64">PORT</span><span style="--shiki-default:#7DCFFF">}</span><span style="--shiki-default:#89DDFF">`</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="60"><span style="--shiki-default:#9ABDF5">})</span><span style="--shiki-default:#89DDFF">;
</span></span></code><!--]--></pre></div><!--]--></li><!--]--></ol><h4 id="menjalankan-api-target-updater-dengan-pm2"><a href="#menjalankan-api-target-updater-dengan-pm2"><!--[-->Menjalankan API Target Updater Dengan PM2<!--]--></a></h4><div class="rounded-lg shadow-md overflow-hidden flex mb-4" data-v-2ca7e668><div class="bg-blue-200 w-4 min-h-full" data-v-2ca7e668></div><div class="bg-white dark:bg-gray-800" data-v-2ca7e668><div class="text-blue-200 flex items-center gap-2 px-2 py-2" data-v-2ca7e668><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="text-blue-500" data-v-2ca7e668><!--[--><!--]--><g><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm16-40a8,8,0,0,1-8,8,16,16,0,0,1-16-16V128a8,8,0,0,1,0-16,16,16,0,0,1,16,16v40A8,8,0,0,1,144,176ZM112,84a12,12,0,1,1,12,12A12,12,0,0,1,112,84Z"></path></g></svg><span class="text-xl font-bold rounded" data-v-2ca7e668>PM2</span></div><div class="px-2" data-v-2ca7e668><!--[--><p><!--[-->PM2 adalah process manager untuk aplikasi Node.js yang berfungsi mengelola, memonitor, dan menjalankan aplikasi secara otomatis dalam lingkungan produksi.<!--]--></p><!--]--></div></div></div><ol><!--[--><li><!--[-->Install PM2:<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">npm</span><span style="--shiki-default:#9ECE6A"> install</span><span style="--shiki-default:#9ECE6A"> pm2</span><span style="--shiki-default:#E0AF68"> -g
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Jalankan aplikasi server target udpater<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">pm2</span><span style="--shiki-default:#9ECE6A"> start</span><span style="--shiki-default:#9ECE6A"> index.js</span><span style="--shiki-default:#E0AF68"> --name</span><span style="--shiki-default:#9ECE6A"> server-list-updater
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Setelah menjalankan index.js, simpan daftar service yang akan dijalankan saat server reboot:<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">pm2</span><span style="--shiki-default:#9ECE6A"> save
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Jalankan perintah <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->pm2 startup<!--]--></code> dan copy/paste command yang diberikan<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">pm2</span><span style="--shiki-default:#9ECE6A"> startup
</span></span><span class="line" line="2"><span style="--shiki-default:#89DDFF">  [</span><span style="--shiki-default:#A9B1D6">PM2</span><span style="--shiki-default:#89DDFF">]</span><span style="--shiki-default:#C0CAF5"> Init</span><span style="--shiki-default:#9ECE6A"> System</span><span style="--shiki-default:#9ECE6A"> found:</span><span style="--shiki-default:#9ECE6A"> systemd
</span></span><span class="line" line="3"><span style="--shiki-default:#89DDFF">  [</span><span style="--shiki-default:#A9B1D6">PM2</span><span style="--shiki-default:#89DDFF">]</span><span style="--shiki-default:#C0CAF5"> To</span><span style="--shiki-default:#9ECE6A"> setup</span><span style="--shiki-default:#9ECE6A"> the</span><span style="--shiki-default:#9ECE6A"> Startup</span><span style="--shiki-default:#9ECE6A"> Script,</span><span style="--shiki-default:#9ECE6A"> copy/paste</span><span style="--shiki-default:#9ECE6A"> the</span><span style="--shiki-default:#9ECE6A"> following</span><span style="--shiki-default:#9ECE6A"> command:
</span></span><span class="line" line="4"><span style="--shiki-default:#C0CAF5">  sudo</span><span style="--shiki-default:#9ECE6A"> env</span><span style="--shiki-default:#9ECE6A"> PATH=</span><span style="--shiki-default:#C0CAF5">$PATH</span><span style="--shiki-default:#9ECE6A">:/home/falestio/.nvm/versions/node/v20.18.0/bin</span><span style="--shiki-default:#9ECE6A"> /home/falestio/.nvm/versions/node/v20.18.0/lib/node_modules/pm2/bin/pm2</span><span style="--shiki-default:#9ECE6A"> startup</span><span style="--shiki-default:#9ECE6A"> systemd</span><span style="--shiki-default:#E0AF68"> -u</span><span style="--shiki-default:#9ECE6A"> falestio</span><span style="--shiki-default:#E0AF68"> --hp</span><span style="--shiki-default:#9ECE6A"> /home/falestio
</span></span></code><!--]--></pre></div><br>Jalankan perintah yang diberikan<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> env</span><span style="--shiki-default:#9ECE6A"> PATH=</span><span style="--shiki-default:#C0CAF5">$PATH</span><span style="--shiki-default:#9ECE6A">:/home/falestio/.nvm/versions/node/v20.18.0/bin</span><span style="--shiki-default:#9ECE6A"> /home/falestio/.nvm/versions/node/v20.18.0/lib/node_modules/pm2/bin/pm2</span><span style="--shiki-default:#9ECE6A"> startup</span><span style="--shiki-default:#9ECE6A"> systemd</span><span style="--shiki-default:#E0AF68"> -u</span><span style="--shiki-default:#9ECE6A"> falestio</span><span style="--shiki-default:#E0AF68"> --hp</span><span style="--shiki-default:#9ECE6A"> /home/falestio
</span></span></code><!--]--></pre></div><br>Sekarang service <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->server-list-updater<!--]--></code> akan tetap berjalan meskipun server di reboot.<!--]--></li><!--]--></ol><h4 id="tes-fungsi-api"><a href="#tes-fungsi-api"><!--[-->Tes Fungsi API<!--]--></a></h4><ol><!--[--><li><!--[-->Jalankan command curl berikut<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">curl</span><span style="--shiki-default:#E0AF68"> -X</span><span style="--shiki-default:#9ECE6A"> POST</span><span style="--shiki-default:#9ECE6A"> http://localhost:3000/update-servers</span><span style="--shiki-default:#89DDFF"> \
</span></span><span class="line" line="2"><span style="--shiki-default:#A9B1D6">-H </span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">Content-Type: application/json</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF"> \
</span></span><span class="line" line="3"><span style="--shiki-default:#A9B1D6">-d </span><span style="--shiki-default:#89DDFF">&#39;</span><span style="--shiki-default:#9ECE6A">{
</span></span><span class="line" line="4"><span style="--shiki-default:#9ECE6A">  &quot;servers&quot;: [
</span></span><span class="line" line="5"><span style="--shiki-default:#9ECE6A">    &quot;http://192.168.1.101:8080&quot;,
</span></span><span class="line" line="6"><span style="--shiki-default:#9ECE6A">    &quot;http://192.168.1.102:8080&quot;
</span></span><span class="line" line="7"><span style="--shiki-default:#9ECE6A">  ]
</span></span><span class="line" line="8"><span style="--shiki-default:#9ECE6A">}</span><span style="--shiki-default:#89DDFF">&#39;
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Cek apakah daftar url sudah berubah<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">cat</span><span style="--shiki-default:#9ECE6A"> /etc/traefik/configs/services.yaml
</span></span></code><!--]--></pre></div><!--]--></li><!--]--></ol><h2 id="implementasi-server-monitoring"><a href="#implementasi-server-monitoring"><!--[-->Implementasi Server Monitoring<!--]--></a></h2><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/monitoring-highlighted.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><p><!--[-->Server ini akan menjalankan Grafana dan Prometheus seabgai tools untuk mengumpulkan data dari server service, menvisualisasikan data tersebut, dan menginisiasi scaling ketika load sistem telah melewati batas yang ditentukan.<!--]--></p><p><!--[-->Bagian ini akan menjelaskan tentang:<!--]--></p><ol><!--[--><li><!--[-->Instalasi dan Konfigurasi Prometheus<!--]--></li><li><!--[-->Instalasi dan Konfigurasi Grafana<!--]--></li><li><!--[-->Menghubungkan Prometheus dan Grafana<!--]--></li><li><!--[-->Setup Dashboard Grafana<!--]--></li><!--]--></ol><div class="rounded-lg shadow-md overflow-hidden flex mb-4" data-v-2ca7e668><div class="bg-blue-200 w-4 min-h-full" data-v-2ca7e668></div><div class="bg-white dark:bg-gray-800" data-v-2ca7e668><div class="text-blue-200 flex items-center gap-2 px-2 py-2" data-v-2ca7e668><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="text-blue-500" data-v-2ca7e668><!--[--><!--]--><g><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm16-40a8,8,0,0,1-8,8,16,16,0,0,1-16-16V128a8,8,0,0,1,0-16,16,16,0,0,1,16,16v40A8,8,0,0,1,144,176ZM112,84a12,12,0,1,1,12,12A12,12,0,0,1,112,84Z"></path></g></svg><span class="text-xl font-bold rounded" data-v-2ca7e668>Sumber</span></div><div class="px-2" data-v-2ca7e668><!--[--><p><!--[-->Panduan instalasi Prometheus dan Grafana pada artikel ini didapat dari: <a href="https://www.linode.com/docs/guides/how-to-install-prometheus-and-grafana-on-ubuntu/#how-to-configure-prometheus-as-a-service" rel="nofollow"><!--[-->https://www.linode.com/docs/guides/how-to-install-prometheus-and-grafana-on-ubuntu/#how-to-configure-prometheus-as-a-service<!--]--></a><!--]--></p><!--]--></div></div></div><h3 id="download-dan-install-prometheus"><a href="#download-dan-install-prometheus"><!--[-->Download dan install prometheus<!--]--></a></h3><p><!--[-->Untuk menginstall Prometheus, ikuti langkah-langkah berikut.<!--]--></p><ol><!--[--><li><!--[-->Cek link berikut untuk mengetahui versi terbaru dari prometheus <a href="https://github.com/prometheus/prometheus/releases" rel="nofollow"><!--[-->https://github.com/prometheus/prometheus/releases<!--]--></a><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">wget</span><span style="--shiki-default:#9ECE6A"> https://github.com/prometheus/prometheus/releases/download/v2.55.0/prometheus-2.55.0.linux-amd64.tar.gz
</span></span></code><!--]--></pre></div><br>Ganti v2.55.0 dengan versi terbaru.<!--]--></li><li><!--[-->Ekstrak file Prometheus<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">tar</span><span style="--shiki-default:#9ECE6A"> xvfz</span><span style="--shiki-default:#9ECE6A"> prometheus-</span><span style="--shiki-default:#F7768E">*</span><span style="--shiki-default:#9ECE6A">.tar.gz
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->(Opsional) Setelah file diekstrak, hapus arsip atau pindahkan ke lokasi lain untuk penyimpanan.<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">rm</span><span style="--shiki-default:#9ECE6A"> prometheus-</span><span style="--shiki-default:#F7768E">*</span><span style="--shiki-default:#9ECE6A">.tar.gz
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Buat dua direktori baru yang akan digunakan oleh Prometheus. Direktori <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->/etc/prometheus<!--]--></code> menyimpan file konfigurasi Prometheus. Direktori <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->/var/lib/prometheus<!--]--></code> menyimpan data aplikasi.<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> mkdir</span><span style="--shiki-default:#9ECE6A"> /etc/prometheus</span><span style="--shiki-default:#9ECE6A"> /var/lib/prometheus
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Masuk ke folder prometheus yang baru diekstrak.<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#0DB9D7">cd</span><span style="--shiki-default:#9ECE6A"> prometheus-2.55.0.linux-amd64
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Pindahkan direktori <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->prometheus<!--]--></code> dan <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->promtool<!--]--></code> ke direktori <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->/usr/local/bin/<!--]--></code>. Ini membuat Prometheus dapat diakses oleh semua pengguna.<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> mv</span><span style="--shiki-default:#9ECE6A"> prometheus</span><span style="--shiki-default:#9ECE6A"> promtool</span><span style="--shiki-default:#9ECE6A"> /usr/local/bin/
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Pindahkan file konfigurasi YAML <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->prometheus.yml<!--]--></code> ke direktori <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->/etc/prometheus<!--]--></code>.<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> mv</span><span style="--shiki-default:#9ECE6A"> prometheus.yml</span><span style="--shiki-default:#9ECE6A"> /etc/prometheus/prometheus.yml
</span></span></code><!--]--></pre></div><br>pindahkan juga folder <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->consoles<!--]--></code> dan <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->console_libraries<!--]--></code>. fodler tersebut tidak dibahas dalam artikel ini. Namun, file-file ini juga harus dipindahkan ke direktori <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->/etc/prometheus<!--]--></code> jika suatu saat diperlukan.<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> mv</span><span style="--shiki-default:#9ECE6A"> consoles/</span><span style="--shiki-default:#9ECE6A"> console_libraries/</span><span style="--shiki-default:#9ECE6A"> /etc/prometheus/
</span></span></code><!--]--></pre></div><br>Setelah direktori ini dipindahkan, hanya file <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->LICENSE<!--]--></code> dan <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->NOTICE<!--]--></code> yang tersisa di direktori asli.<!--]--></li><li><!--[-->Verifikasi bahwa Prometheus berhasil diinstal dengan menggunakan perintah berikut:<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">prometheus</span><span style="--shiki-default:#E0AF68"> --version
</span></span></code><!--]--></pre></div><br>Contoh output:<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">prometheus,</span><span style="--shiki-default:#9ECE6A"> version</span><span style="--shiki-default:#FF9E64"> 2.55.0</span><span style="--shiki-default:#A9B1D6"> (branch: </span><span style="--shiki-default:#9ECE6A">HEAD,</span><span style="--shiki-default:#9ECE6A"> revision:</span><span style="--shiki-default:#9ECE6A"> 9sda30252c3e528722890348das8dasdd720f6be07cb8</span><span style="--shiki-default:#A9B1D6">)
</span></span><span class="line" line="2"><span style="--shiki-default:#C0CAF5">  build</span><span style="--shiki-default:#9ECE6A"> user:</span><span style="--shiki-default:#9ECE6A">       root@9fad779131cc
</span></span><span class="line" line="3"><span style="--shiki-default:#C0CAF5">  build</span><span style="--shiki-default:#9ECE6A"> date:</span><span style="--shiki-default:#9ECE6A">       20241022-13:47:22
</span></span><span class="line" line="4"><span style="--shiki-default:#C0CAF5">  go</span><span style="--shiki-default:#9ECE6A"> version:</span><span style="--shiki-default:#9ECE6A">       go1.23.2
</span></span><span class="line" line="5"><span style="--shiki-default:#C0CAF5">  platform:</span><span style="--shiki-default:#9ECE6A">         linux/amd64
</span></span><span class="line" line="6"><span style="--shiki-default:#C0CAF5">  tags:</span><span style="--shiki-default:#9ECE6A">             netgo,builtinassets,stringlabels
</span></span></code><!--]--></pre></div><!--]--></li><!--]--></ol><h3 id="menjalankan-prometheus-sebagai-systemd"><a href="#menjalankan-prometheus-sebagai-systemd"><!--[-->Menjalankan Prometheus Sebagai Systemd<!--]--></a></h3><p><!--[-->Meskipun Prometheus bisa dijalankan dan dihentikan langsung dari command line, lebih praktis kalau dijalankan sebagai service menggunakan systemd.<!--]--></p><ol><!--[--><li><!--[-->Buat user untuk Prometheus. Perintah berikut akan membuat user sistem:<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> useradd</span><span style="--shiki-default:#E0AF68"> -rs</span><span style="--shiki-default:#9ECE6A"> /bin/</span><span style="--shiki-default:#FF9E64">false</span><span style="--shiki-default:#9ECE6A"> prometheus
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Ubah kepemilikan dua direktori yang sudah dibuat sebelumnya ke user <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->prometheus<!--]--></code> yang baru.<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> chown</span><span style="--shiki-default:#E0AF68"> -R</span><span style="--shiki-default:#9ECE6A"> prometheus:</span><span style="--shiki-default:#9ECE6A"> /etc/prometheus</span><span style="--shiki-default:#9ECE6A"> /var/lib/prometheus
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Untuk menjalankan Prometheus sebagai service, buat file <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->prometheus.service<!--]--></code> dengan perintah ini:<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> nano</span><span style="--shiki-default:#9ECE6A"> /etc/systemd/system/prometheus.service
</span></span></code><!--]--></pre></div><br>Lalu masukan kode berikut:<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md"><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><!----></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="overflow-auto p-3"><!--[--><code>[Unit]
Description=Prometheus
Wants=network-online.target
After=network-online.target

[Service]
User=prometheus
Group=prometheus
Type=simple
Restart=on-failure
RestartSec=5s
ExecStart=/usr/local/bin/prometheus \
    --config.file /etc/prometheus/prometheus.yml \
    --storage.tsdb.path /var/lib/prometheus/ \
    --web.console.templates=/etc/prometheus/consoles \
    --web.console.libraries=/etc/prometheus/console_libraries \
    --web.listen-address=0.0.0.0:9090 \
    --web.enable-lifecycle \
    --log.level=info

[Install]
WantedBy=multi-user.target
</code><!--]--></pre></div><!--]--></li><li><!--[-->Setelah itu, reload daemon:<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> systemctl</span><span style="--shiki-default:#9ECE6A"> daemon-reload
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Gunakan perintah <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->systemctl enable<!--]--></code> agar Prometheus otomatis mulai saat sistem di-boot.<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> systemctl</span><span style="--shiki-default:#9ECE6A"> enable</span><span style="--shiki-default:#9ECE6A"> prometheus
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Jalankan service Prometheus dan cek statusnya untuk memastikan sudah aktif.<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> systemctl</span><span style="--shiki-default:#9ECE6A"> start</span><span style="--shiki-default:#9ECE6A"> prometheus
</span></span><span class="line" line="2"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> systemctl</span><span style="--shiki-default:#9ECE6A"> status</span><span style="--shiki-default:#9ECE6A"> prometheus
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Akses interface web dan dashboard Prometheus di <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->http://local_ip_addr:9090<!--]--></code>. Ganti <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->local_ip_addr<!--]--></code> dengan alamat IP server monitoring. Karena menggunakan file konfigurasi default, informasi yang ditampilkan masih terbatas.<!--]--></li><!--]--></ol><h3 id="edit-file-konfigurasi"><a href="#edit-file-konfigurasi"><!--[-->Edit file Konfigurasi<!--]--></a></h3><ol><!--[--><li><!--[-->Edit file konfigurasi prometheus<br>Pada server monitoring yang menjalankan Prometheus, buka file <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->prometheus.yml<!--]--></code> untuk diedit.<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> nano</span><span style="--shiki-default:#9ECE6A"> /etc/prometheus/prometheus.yml
</span></span></code><!--]--></pre></div><br>isi dengan kode berikut:<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><!----></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-yaml shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#F7768E">global</span><span style="--shiki-default:#89DDFF">:
</span></span><span class="line" line="2"><span style="--shiki-default:#F7768E">  scrape_interval</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#9ECE6A"> 5s
</span></span><span class="line" line="3"><span emptylineplaceholder="true">
</span></span><span class="line" line="4"><span style="--shiki-default:#F7768E">scrape_configs</span><span style="--shiki-default:#89DDFF">:
</span></span><span class="line" line="5"><span style="--shiki-default:#9ABDF5">  -</span><span style="--shiki-default:#F7768E"> job_name</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">calculate_service_clones</span><span style="--shiki-default:#89DDFF">&quot;
</span></span><span class="line" line="6"><span style="--shiki-default:#F7768E">    file_sd_configs</span><span style="--shiki-default:#89DDFF">:
</span></span><span class="line" line="7"><span style="--shiki-default:#9ABDF5">      -</span><span style="--shiki-default:#F7768E"> files</span><span style="--shiki-default:#89DDFF">:
</span></span><span class="line" line="8"><span style="--shiki-default:#9ABDF5">          -</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">targets.json</span><span style="--shiki-default:#89DDFF">&quot;
</span></span><span class="line" line="9"><span emptylineplaceholder="true">
</span></span><span class="line" line="10"><span style="--shiki-default:#9ABDF5">  -</span><span style="--shiki-default:#F7768E"> job_name</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">calculate_service_seed</span><span style="--shiki-default:#89DDFF">&quot;
</span></span><span class="line" line="11"><span style="--shiki-default:#F7768E">    static_configs</span><span style="--shiki-default:#89DDFF">:
</span></span><span class="line" line="12"><span style="--shiki-default:#9ABDF5">      -</span><span style="--shiki-default:#F7768E"> targets</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#89DDFF"> [</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">&lt;private_ip&gt;:9100</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">]
</span></span></code><!--]--></pre></div><ul><!--[--><li><!--[--><code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->scrape_interval<!--]--></code>: Interval waktu (5 detik) untuk Prometheus mengambil data dari target.<!--]--></li><li><!--[--><code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->job_name: &quot;calculate_service_clones&quot;<!--]--></code>: ini adalah job untuk mengumpulkan data sistem dari server clone. Daftar server yang akan di clone berada pada file targets.json. ini dilakukan karena daftar server bersifat dinamis (selalu berubah).<!--]--></li><li><!--[--><code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->job_name: &quot;calculate_service_seed&quot;<!--]--></code>: mengarah ke service seed, service seed akan selalu ada jadi menggunakan <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->static_configs<!--]--></code><!--]--></li><!--]--></ul><!--]--></li><li><!--[-->Buatlah file targets.json<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> nano</span><span style="--shiki-default:#9ECE6A"> /etc/prometheus/targets.json
</span></span></code><!--]--></pre></div><br>Lalu cukup isi file dengan array kosong <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->[]<!--]--></code>.<br>File ini akan diupdate oleh prometheus target updater, untuk permissions dari file perlu di modifikasi sehingga target updater (express) dapat melakukan perubahan kepada file.<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> chmod</span><span style="--shiki-default:#E0AF68"> -R</span><span style="--shiki-default:#9ECE6A"> a+rwx</span><span style="--shiki-default:#9ECE6A"> /etc/prometheus/targets.json
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Restart Prometheus dan cek kembali <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->http://local_ip_addr:9090<!--]--></code><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> systemctl</span><span style="--shiki-default:#9ECE6A"> restart</span><span style="--shiki-default:#9ECE6A"> prometheus
</span></span></code><!--]--></pre></div><!--]--></li><!--]--></ol><div class="rounded-lg shadow-md overflow-hidden flex mb-4" data-v-2ca7e668><div class="bg-blue-200 w-4 min-h-full" data-v-2ca7e668></div><div class="bg-white dark:bg-gray-800" data-v-2ca7e668><div class="text-blue-200 flex items-center gap-2 px-2 py-2" data-v-2ca7e668><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="text-blue-500" data-v-2ca7e668><!--[--><!--]--><g><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm16-40a8,8,0,0,1-8,8,16,16,0,0,1-16-16V128a8,8,0,0,1,0-16,16,16,0,0,1,16,16v40A8,8,0,0,1,144,176ZM112,84a12,12,0,1,1,12,12A12,12,0,0,1,112,84Z"></path></g></svg><span class="text-xl font-bold rounded" data-v-2ca7e668>Memonitor API gateway</span></div><div class="px-2" data-v-2ca7e668><!--[--><p><!--[-->Anda bisa mengimplementasikan monitoring terhadap server api gateway jika diperlukan, namun agar sistem autoscaling berjalan anda tidak perlu melakukan itu<!--]--></p><!--]--></div></div></div><h3 id="pembuatan-webhook-handler"><a href="#pembuatan-webhook-handler"><!--[-->Pembuatan Webhook Handler<!--]--></a></h3><p><!--[-->Webhook handler adalah endpoint yang akan dipanggil oleh Grafana Alert ketika salah satu proses scaling terjadi. Sistem ini akan berinteraksi dengan IDCloudHost API untuk melakukan clone pada server seed dan mengupdate daftar target di Server Traefik dan Server monitoring.<!--]--></p><p><!--[-->Webhook hanler berbentuk server Node dengan menggunakan library Express.<!--]--></p><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/webhook-handler-highlighted.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><ol><!--[--><li><!--[-->Buat API Token untuk mengakses IDCloudHost API:<br>Pergi ke halaman access lalu klik tombol &quot;Create New Access&quot;.<div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/create-new-access.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><br>Pilih tipe &quot;API Token&quot;, sesuaikan scope, billing account, dan access name.<br>Simpan API Token untuk digunakan membuat webhook handler.<div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/api-token.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><!--]--></li><li><!--[-->Buat folder webhook handler dan inisiasi proyek node<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> mkdir</span><span style="--shiki-default:#9ECE6A"> webhook-handler
</span></span><span class="line" line="2"><span style="--shiki-default:#C0CAF5">npm</span><span style="--shiki-default:#9ECE6A"> init</span><span style="--shiki-default:#E0AF68"> -y
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Install library yang diperlukan<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">npm</span><span style="--shiki-default:#9ECE6A"> install</span><span style="--shiki-default:#9ECE6A"> express</span><span style="--shiki-default:#9ECE6A"> axios
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Isi index.js dengan kode berikut<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>prometheus-target-updater/index.js</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-js shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#BB9AF7"> express</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#7AA2F7"> require</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">express</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="2"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#BB9AF7"> axios</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#7AA2F7"> require</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">axios</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="3"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#89DDFF"> {</span><span style="--shiki-default:#BB9AF7"> exec</span><span style="--shiki-default:#89DDFF"> }</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#7AA2F7"> require</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">child_process</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="4"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#BB9AF7"> app</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#7AA2F7"> express</span><span style="--shiki-default:#9ABDF5">()</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="5"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#BB9AF7"> fs</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#7AA2F7"> require</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">fs</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="6"><span emptylineplaceholder="true">
</span></span><span class="line" line="7"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">// ========= SESUAIKAN BAGIAN INI - GUNAKAN ENV ATAU SECRET MANAGER LAIN =========
</span></span><span class="line" line="8"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">// API Token yang dibuat pada bagian ini
</span></span><span class="line" line="9"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#BB9AF7"> apiKey</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">IBlVjA6KTfJlH5nYO79mAQBwYCxGhv71</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="10"><span emptylineplaceholder="true">
</span></span><span class="line" line="11"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">// UUID dari private network yang dibuat pada awal artikel
</span></span><span class="line" line="12"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#BB9AF7"> privateNetworkUuid</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">b34ec3de-76ef-4720-8737-7662f52f6f89</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="13"><span emptylineplaceholder="true">
</span></span><span class="line" line="14"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">// UUID dari service seed
</span></span><span class="line" line="15"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#BB9AF7"> serviceSeedUuid</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">a0c79e13-6eda-4e68-a64c-91637589ec55</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="16"><span emptylineplaceholder="true">
</span></span><span class="line" line="17"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">// pergi ke halaman billing dna klik pada detail salah satu billing account
</span></span><span class="line" line="18"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#BB9AF7"> billingAccountId</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">1200211740</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="19"><span emptylineplaceholder="true">
</span></span><span class="line" line="20"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">// nama pertama dari service clone, dingunakan untuk menetukan nama server dari service clone
</span></span><span class="line" line="21"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">// yaitu: calculate-service-clone-{nomorurut}
</span></span><span class="line" line="22"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#BB9AF7"> serviceChildFirstName</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">calculate-service-clone-</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="23"><span emptylineplaceholder="true">
</span></span><span class="line" line="24"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">// file path ke file targets.json yang berisi daftar server yang terhubung ke server monitoring
</span></span><span class="line" line="25"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#BB9AF7"> prometheusTargetsFilePath</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">/etc/prometheus/targets.json</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="26"><span emptylineplaceholder="true">
</span></span><span class="line" line="27"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">// Url dari target updater yang ada di server Traefik
</span></span><span class="line" line="28"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#BB9AF7"> updateTraefikTargetsUrl</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">http://10.52.76.11:3000/update-servers</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="29"><span emptylineplaceholder="true">
</span></span><span class="line" line="30"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">// Port dimana aplikasi service dijalankan di server service
</span></span><span class="line" line="31"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#BB9AF7"> servicePort</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#FF9E64"> 3000</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="32"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">// =====================================================================
</span></span><span class="line" line="33"><span emptylineplaceholder="true">
</span></span><span class="line" line="34"><span style="--shiki-default:#C0CAF5">app</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">use</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">express</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">json</span><span style="--shiki-default:#9ABDF5">())</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="35"><span emptylineplaceholder="true">
</span></span><span class="line" line="36"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">// Fetching data semua VM service
</span></span><span class="line" line="37"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#7AA2F7"> getServiceVmsData</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic"> async</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#E0AF68">filterPrefix</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">calculate-service-</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#BB9AF7"> =&gt;</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="38"><span style="--shiki-default:#BB9AF7">  try</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="39"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">    const</span><span style="--shiki-default:#89DDFF"> {</span><span style="--shiki-default:#BB9AF7"> data</span><span style="--shiki-default:#89DDFF"> }</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic"> await</span><span style="--shiki-default:#C0CAF5"> axios</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">get</span><span style="--shiki-default:#9ABDF5">(
</span></span><span class="line" line="40"><span style="--shiki-default:#89DDFF">      &quot;</span><span style="--shiki-default:#9ECE6A">https://api.idcloudhost.com/v1/jkt01/user-resource/vm/list</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="41"><span style="--shiki-default:#9ABDF5">      { </span><span style="--shiki-default:#73DACA">headers</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#9ABDF5"> { </span><span style="--shiki-default:#73DACA">apikey</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#C0CAF5"> apiKey</span><span style="--shiki-default:#9ABDF5"> } }
</span></span><span class="line" line="42"><span style="--shiki-default:#9ABDF5">    )</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="43"><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic">    return</span><span style="--shiki-default:#C0CAF5"> data</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">filter</span><span style="--shiki-default:#9ABDF5">((</span><span style="--shiki-default:#E0AF68">vm</span><span style="--shiki-default:#9ABDF5">) </span><span style="--shiki-default:#BB9AF7">=&gt;</span><span style="--shiki-default:#C0CAF5"> vm</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7DCFFF">name</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">startsWith</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">filterPrefix</span><span style="--shiki-default:#9ABDF5">))</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="44"><span style="--shiki-default:#9ABDF5">  } </span><span style="--shiki-default:#BB9AF7">catch</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#C0CAF5">error</span><span style="--shiki-default:#9ABDF5">) {
</span></span><span class="line" line="45"><span style="--shiki-default:#C0CAF5">    console</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">error</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">Error fetching VM data:</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#C0CAF5"> error</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7DCFFF">message</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="46"><span style="--shiki-default:#BB9AF7">    throw</span><span style="--shiki-default:#C0CAF5"> error</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="47"><span style="--shiki-default:#9ABDF5">  }
</span></span><span class="line" line="48"><span style="--shiki-default:#9ABDF5">}</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="49"><span emptylineplaceholder="true">
</span></span><span class="line" line="50"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">// clone terhadap service seed server
</span></span><span class="line" line="51"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#7AA2F7"> cloneVM</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic"> async</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#E0AF68">name</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#BB9AF7"> =&gt;</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="52"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">  const</span><span style="--shiki-default:#89DDFF"> {</span><span style="--shiki-default:#BB9AF7"> data</span><span style="--shiki-default:#89DDFF"> }</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic"> await</span><span style="--shiki-default:#C0CAF5"> axios</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">post</span><span style="--shiki-default:#9ABDF5">(
</span></span><span class="line" line="53"><span style="--shiki-default:#89DDFF">    `</span><span style="--shiki-default:#9ECE6A">https://api.idcloudhost.com/v1/jkt01/user-resource/vm/clone?uuid=</span><span style="--shiki-default:#7DCFFF">${</span><span style="--shiki-default:#C0CAF5">serviceSeedUuid</span><span style="--shiki-default:#7DCFFF">}</span><span style="--shiki-default:#9ECE6A">&amp;name=</span><span style="--shiki-default:#7DCFFF">${</span><span style="--shiki-default:#C0CAF5">name</span><span style="--shiki-default:#7DCFFF">}</span><span style="--shiki-default:#89DDFF">`</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="54"><span style="--shiki-default:#9ABDF5">    {}</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="55"><span style="--shiki-default:#9ABDF5">    { </span><span style="--shiki-default:#73DACA">headers</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#9ABDF5"> { </span><span style="--shiki-default:#73DACA">apikey</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#C0CAF5"> apiKey</span><span style="--shiki-default:#9ABDF5"> } }
</span></span><span class="line" line="56"><span style="--shiki-default:#9ABDF5">  )</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="57"><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic">  return</span><span style="--shiki-default:#C0CAF5"> data</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="58"><span style="--shiki-default:#9ABDF5">}</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="59"><span emptylineplaceholder="true">
</span></span><span class="line" line="60"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">// hapus public ip dari VM yang baru di Clone
</span></span><span class="line" line="61"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#7AA2F7"> deletePublicIp</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic"> async</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#E0AF68">vmUuid</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#BB9AF7"> =&gt;</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="62"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">  const</span><span style="--shiki-default:#89DDFF"> {</span><span style="--shiki-default:#BB9AF7"> data</span><span style="--shiki-default:#89DDFF"> }</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic"> await</span><span style="--shiki-default:#C0CAF5"> axios</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">get</span><span style="--shiki-default:#9ABDF5">(
</span></span><span class="line" line="63"><span style="--shiki-default:#89DDFF">    `</span><span style="--shiki-default:#9ECE6A">https://api.idcloudhost.com/v1/jkt01/network/ip_addresses?billing_account_id=</span><span style="--shiki-default:#7DCFFF">${</span><span style="--shiki-default:#C0CAF5">billingAccountId</span><span style="--shiki-default:#7DCFFF">}</span><span style="--shiki-default:#89DDFF">`</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="64"><span style="--shiki-default:#9ABDF5">    { </span><span style="--shiki-default:#73DACA">headers</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#9ABDF5"> { </span><span style="--shiki-default:#73DACA">apikey</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#C0CAF5"> apiKey</span><span style="--shiki-default:#9ABDF5"> } }
</span></span><span class="line" line="65"><span style="--shiki-default:#9ABDF5">  )</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="66"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">  const</span><span style="--shiki-default:#BB9AF7"> ip</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#C0CAF5"> data</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">find</span><span style="--shiki-default:#9ABDF5">((</span><span style="--shiki-default:#E0AF68">ip</span><span style="--shiki-default:#9ABDF5">) </span><span style="--shiki-default:#BB9AF7">=&gt;</span><span style="--shiki-default:#C0CAF5"> ip</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7DCFFF">assigned_to</span><span style="--shiki-default:#BB9AF7"> ===</span><span style="--shiki-default:#C0CAF5"> vmUuid</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="67"><span style="--shiki-default:#BB9AF7">  if</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#C0CAF5">ip</span><span style="--shiki-default:#9ABDF5">) {
</span></span><span class="line" line="68"><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic">    await</span><span style="--shiki-default:#C0CAF5"> axios</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">delete</span><span style="--shiki-default:#9ABDF5">(
</span></span><span class="line" line="69"><span style="--shiki-default:#89DDFF">      `</span><span style="--shiki-default:#9ECE6A">https://api.idcloudhost.com/v1/jkt01/network/ip_addresses/</span><span style="--shiki-default:#7DCFFF">${</span><span style="--shiki-default:#C0CAF5">ip</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7DCFFF">address</span><span style="--shiki-default:#7DCFFF">}</span><span style="--shiki-default:#89DDFF">`</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="70"><span style="--shiki-default:#9ABDF5">      { </span><span style="--shiki-default:#73DACA">headers</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#9ABDF5"> { </span><span style="--shiki-default:#73DACA">apikey</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#C0CAF5"> apiKey</span><span style="--shiki-default:#9ABDF5"> } }
</span></span><span class="line" line="71"><span style="--shiki-default:#9ABDF5">    )</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="72"><span style="--shiki-default:#9ABDF5">  }
</span></span><span class="line" line="73"><span style="--shiki-default:#9ABDF5">}</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="74"><span emptylineplaceholder="true">
</span></span><span class="line" line="75"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">// update daftar target pada server service dan prometheus
</span></span><span class="line" line="76"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#7AA2F7"> updateTargets</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic"> async</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#E0AF68">type</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#E0AF68"> data</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#BB9AF7"> =&gt;</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="77"><span style="--shiki-default:#BB9AF7">  if</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#C0CAF5">type</span><span style="--shiki-default:#BB9AF7"> ===</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">prometheus</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5">) {
</span></span><span class="line" line="78"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">    const</span><span style="--shiki-default:#BB9AF7"> prometheusTargets</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#9ABDF5"> [
</span></span><span class="line" line="79"><span style="--shiki-default:#9ABDF5">      {
</span></span><span class="line" line="80"><span style="--shiki-default:#73DACA">        labels</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="81"><span style="--shiki-default:#73DACA">          job</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">calculate_service_clone</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="82"><span style="--shiki-default:#9ABDF5">        }</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="83"><span style="--shiki-default:#73DACA">        targets</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#C0CAF5"> data</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">map</span><span style="--shiki-default:#9ABDF5">((</span><span style="--shiki-default:#E0AF68">ip</span><span style="--shiki-default:#9ABDF5">) </span><span style="--shiki-default:#BB9AF7">=&gt;</span><span style="--shiki-default:#89DDFF"> `</span><span style="--shiki-default:#7DCFFF">${</span><span style="--shiki-default:#7DCFFF">ip</span><span style="--shiki-default:#7DCFFF">}</span><span style="--shiki-default:#9ECE6A">:9100</span><span style="--shiki-default:#89DDFF">`</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="84"><span style="--shiki-default:#9ABDF5">      }</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="85"><span style="--shiki-default:#9ABDF5">    ]</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="86"><span emptylineplaceholder="true">
</span></span><span class="line" line="87"><span style="--shiki-default:#BB9AF7">    try</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="88"><span style="--shiki-default:#C0CAF5">      fs</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">writeFileSync</span><span style="--shiki-default:#9ABDF5">(
</span></span><span class="line" line="89"><span style="--shiki-default:#C0CAF5">        prometheusTargetsFilePath</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="90"><span style="--shiki-default:#0DB9D7">        JSON</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">stringify</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">prometheusTargets</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#FF9E64"> null</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#FF9E64"> 2</span><span style="--shiki-default:#9ABDF5">)
</span></span><span class="line" line="91"><span style="--shiki-default:#9ABDF5">      )</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="92"><span style="--shiki-default:#C0CAF5">      console</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">log</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">Prometheus targets updated</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="93"><span style="--shiki-default:#9ABDF5">    } </span><span style="--shiki-default:#BB9AF7">catch</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#C0CAF5">err</span><span style="--shiki-default:#9ABDF5">) {
</span></span><span class="line" line="94"><span style="--shiki-default:#C0CAF5">      console</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">error</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">Error updating Prometheus targets:</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#C0CAF5"> err</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7DCFFF">message</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="95"><span style="--shiki-default:#BB9AF7">      throw</span><span style="--shiki-default:#C0CAF5"> err</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="96"><span style="--shiki-default:#9ABDF5">    }
</span></span><span class="line" line="97"><span style="--shiki-default:#9ABDF5">  } </span><span style="--shiki-default:#BB9AF7">else</span><span style="--shiki-default:#BB9AF7"> if</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#C0CAF5">type</span><span style="--shiki-default:#BB9AF7"> ===</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">traefik</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5">) {
</span></span><span class="line" line="98"><span style="--shiki-default:#BB9AF7">    try</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="99"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">      const</span><span style="--shiki-default:#BB9AF7"> servers</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#C0CAF5"> data</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">map</span><span style="--shiki-default:#9ABDF5">((</span><span style="--shiki-default:#E0AF68">ip</span><span style="--shiki-default:#9ABDF5">) </span><span style="--shiki-default:#BB9AF7">=&gt;</span><span style="--shiki-default:#89DDFF"> `</span><span style="--shiki-default:#9ECE6A">http://</span><span style="--shiki-default:#7DCFFF">${</span><span style="--shiki-default:#C0CAF5">ip</span><span style="--shiki-default:#7DCFFF">}</span><span style="--shiki-default:#9ECE6A">:</span><span style="--shiki-default:#7DCFFF">${</span><span style="--shiki-default:#C0CAF5">servicePort</span><span style="--shiki-default:#7DCFFF">}</span><span style="--shiki-default:#89DDFF">`</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="100"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">      const</span><span style="--shiki-default:#BB9AF7"> response</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic"> await</span><span style="--shiki-default:#C0CAF5"> axios</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">post</span><span style="--shiki-default:#9ABDF5">(
</span></span><span class="line" line="101"><span style="--shiki-default:#C0CAF5">        updateTraefikTargetsUrl</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="102"><span style="--shiki-default:#9ABDF5">        { </span><span style="--shiki-default:#C0CAF5">servers</span><span style="--shiki-default:#9ABDF5"> }</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="103"><span style="--shiki-default:#9ABDF5">        { </span><span style="--shiki-default:#73DACA">headers</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#9ABDF5"> { </span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">Content-Type</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">application/json</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5"> } }
</span></span><span class="line" line="104"><span style="--shiki-default:#9ABDF5">      )</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="105"><span style="--shiki-default:#C0CAF5">      console</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">log</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">Traefik targets updated:</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#C0CAF5"> response</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7DCFFF">data</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="106"><span style="--shiki-default:#9ABDF5">    } </span><span style="--shiki-default:#BB9AF7">catch</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#C0CAF5">error</span><span style="--shiki-default:#9ABDF5">) {
</span></span><span class="line" line="107"><span style="--shiki-default:#C0CAF5">      console</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">error</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">Error updating Traefik targets:</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#C0CAF5"> error</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7DCFFF">message</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="108"><span style="--shiki-default:#BB9AF7">      throw</span><span style="--shiki-default:#C0CAF5"> error</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="109"><span style="--shiki-default:#9ABDF5">    }
</span></span><span class="line" line="110"><span style="--shiki-default:#9ABDF5">  }
</span></span><span class="line" line="111"><span style="--shiki-default:#9ABDF5">}</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="112"><span emptylineplaceholder="true">
</span></span><span class="line" line="113"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#7AA2F7"> scaleUpHandler</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic"> async</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#E0AF68">req</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#E0AF68"> res</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#BB9AF7"> =&gt;</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="114"><span style="--shiki-default:#BB9AF7">  try</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="115"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">    const</span><span style="--shiki-default:#BB9AF7"> serviceVms</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic"> await</span><span style="--shiki-default:#7AA2F7"> getServiceVmsData</span><span style="--shiki-default:#9ABDF5">()</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="116"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">    const</span><span style="--shiki-default:#BB9AF7"> newVmData</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic"> await</span><span style="--shiki-default:#7AA2F7"> cloneVM</span><span style="--shiki-default:#9ABDF5">(
</span></span><span class="line" line="117"><span style="--shiki-default:#89DDFF">      `</span><span style="--shiki-default:#7DCFFF">${</span><span style="--shiki-default:#C0CAF5">serviceChildFirstName</span><span style="--shiki-default:#7DCFFF">}${</span><span style="--shiki-default:#C0CAF5">serviceVms</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7DCFFF">length</span><span style="--shiki-default:#7DCFFF">}</span><span style="--shiki-default:#89DDFF">`
</span></span><span class="line" line="118"><span style="--shiki-default:#9ABDF5">    )</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="119"><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic">    await</span><span style="--shiki-default:#7AA2F7"> deletePublicIp</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">newVmData</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7DCFFF">uuid</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="120"><span emptylineplaceholder="true">
</span></span><span class="line" line="121"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">    const</span><span style="--shiki-default:#BB9AF7"> updatedVms</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic"> await</span><span style="--shiki-default:#7AA2F7"> getServiceVmsData</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">serviceChildFirstName</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="122"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">    const</span><span style="--shiki-default:#BB9AF7"> privateIps</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#C0CAF5"> updatedVms</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">map</span><span style="--shiki-default:#9ABDF5">((</span><span style="--shiki-default:#E0AF68">vm</span><span style="--shiki-default:#9ABDF5">) </span><span style="--shiki-default:#BB9AF7">=&gt;</span><span style="--shiki-default:#C0CAF5"> vm</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7DCFFF">private_ipv4</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="123"><span emptylineplaceholder="true">
</span></span><span class="line" line="124"><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic">    await</span><span style="--shiki-default:#7AA2F7"> updateTargets</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">prometheus</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#C0CAF5"> privateIps</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="125"><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic">    await</span><span style="--shiki-default:#7AA2F7"> updateTargets</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">traefik</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#C0CAF5"> privateIps</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="126"><span emptylineplaceholder="true">
</span></span><span class="line" line="127"><span style="--shiki-default:#C0CAF5">    res</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">send</span><span style="--shiki-default:#9ABDF5">({ </span><span style="--shiki-default:#C0CAF5">newVmData</span><span style="--shiki-default:#9ABDF5"> })</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="128"><span style="--shiki-default:#9ABDF5">  } </span><span style="--shiki-default:#BB9AF7">catch</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#C0CAF5">error</span><span style="--shiki-default:#9ABDF5">) {
</span></span><span class="line" line="129"><span style="--shiki-default:#C0CAF5">    res</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">status</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#FF9E64">500</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">send</span><span style="--shiki-default:#9ABDF5">({ </span><span style="--shiki-default:#73DACA">error</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#C0CAF5"> error</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7DCFFF">message</span><span style="--shiki-default:#9ABDF5"> })</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="130"><span style="--shiki-default:#9ABDF5">  }
</span></span><span class="line" line="131"><span style="--shiki-default:#9ABDF5">}</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="132"><span emptylineplaceholder="true">
</span></span><span class="line" line="133"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#7AA2F7"> scaleDownHandler</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic"> async</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#E0AF68">req</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#E0AF68"> res</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#BB9AF7"> =&gt;</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="134"><span style="--shiki-default:#BB9AF7">  try</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="135"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">    const</span><span style="--shiki-default:#BB9AF7"> vmList</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic"> await</span><span style="--shiki-default:#7AA2F7"> getServiceVmsData</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">serviceChildFirstName</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="136"><span style="--shiki-default:#BB9AF7">    if</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#BB9AF7">!</span><span style="--shiki-default:#C0CAF5">vmList</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7DCFFF">length</span><span style="--shiki-default:#9ABDF5">)
</span></span><span class="line" line="137"><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic">      return</span><span style="--shiki-default:#C0CAF5"> res</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">send</span><span style="--shiki-default:#9ABDF5">({ </span><span style="--shiki-default:#73DACA">message</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">No child VM, scale down aborted</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5"> })</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="138"><span emptylineplaceholder="true">
</span></span><span class="line" line="139"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">    const</span><span style="--shiki-default:#BB9AF7"> vmToDelete</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#C0CAF5"> vmList</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">sort</span><span style="--shiki-default:#9ABDF5">(
</span></span><span class="line" line="140"><span style="--shiki-default:#9ABDF5">      (</span><span style="--shiki-default:#E0AF68">a</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#E0AF68"> b</span><span style="--shiki-default:#9ABDF5">) </span><span style="--shiki-default:#BB9AF7">=&gt;</span><span style="--shiki-default:#89DDFF"> new</span><span style="--shiki-default:#7AA2F7"> Date</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">b</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7DCFFF">created_at</span><span style="--shiki-default:#9ABDF5">) </span><span style="--shiki-default:#89DDFF">-</span><span style="--shiki-default:#89DDFF"> new</span><span style="--shiki-default:#7AA2F7"> Date</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">a</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7DCFFF">created_at</span><span style="--shiki-default:#9ABDF5">)
</span></span><span class="line" line="141"><span style="--shiki-default:#9ABDF5">    )[</span><span style="--shiki-default:#FF9E64">0</span><span style="--shiki-default:#9ABDF5">]</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="142"><span emptylineplaceholder="true">
</span></span><span class="line" line="143"><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic">    await</span><span style="--shiki-default:#C0CAF5"> axios</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">delete</span><span style="--shiki-default:#9ABDF5">(
</span></span><span class="line" line="144"><span style="--shiki-default:#89DDFF">      `</span><span style="--shiki-default:#9ECE6A">https://api.idcloudhost.com/v1/jkt01/user-resource/vm?uuid=</span><span style="--shiki-default:#7DCFFF">${</span><span style="--shiki-default:#C0CAF5">vmToDelete</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7DCFFF">uuid</span><span style="--shiki-default:#7DCFFF">}</span><span style="--shiki-default:#89DDFF">`</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="145"><span style="--shiki-default:#9ABDF5">      { </span><span style="--shiki-default:#73DACA">headers</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#9ABDF5"> { </span><span style="--shiki-default:#73DACA">apikey</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#C0CAF5"> apiKey</span><span style="--shiki-default:#9ABDF5"> } }
</span></span><span class="line" line="146"><span style="--shiki-default:#9ABDF5">    )</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="147"><span emptylineplaceholder="true">
</span></span><span class="line" line="148"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">    const</span><span style="--shiki-default:#BB9AF7"> updatedVms</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic"> await</span><span style="--shiki-default:#7AA2F7"> getServiceVmsData</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">serviceChildFirstName</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="149"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">    const</span><span style="--shiki-default:#BB9AF7"> privateIps</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#C0CAF5"> updatedVms</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">map</span><span style="--shiki-default:#9ABDF5">((</span><span style="--shiki-default:#E0AF68">vm</span><span style="--shiki-default:#9ABDF5">) </span><span style="--shiki-default:#BB9AF7">=&gt;</span><span style="--shiki-default:#C0CAF5"> vm</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7DCFFF">private_ipv4</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="150"><span emptylineplaceholder="true">
</span></span><span class="line" line="151"><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic">    await</span><span style="--shiki-default:#7AA2F7"> updateTargets</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">prometheus</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#C0CAF5"> privateIps</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="152"><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic">    await</span><span style="--shiki-default:#7AA2F7"> updateTargets</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">traefik</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#C0CAF5"> privateIps</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="153"><span emptylineplaceholder="true">
</span></span><span class="line" line="154"><span style="--shiki-default:#C0CAF5">    res</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">send</span><span style="--shiki-default:#9ABDF5">({ </span><span style="--shiki-default:#73DACA">message</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">VM Deleted</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#73DACA"> vmDeleted</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#C0CAF5"> vmToDelete</span><span style="--shiki-default:#9ABDF5"> })</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="155"><span style="--shiki-default:#9ABDF5">  } </span><span style="--shiki-default:#BB9AF7">catch</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#C0CAF5">error</span><span style="--shiki-default:#9ABDF5">) {
</span></span><span class="line" line="156"><span style="--shiki-default:#C0CAF5">    res</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">status</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#FF9E64">500</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">send</span><span style="--shiki-default:#9ABDF5">({ </span><span style="--shiki-default:#73DACA">error</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#C0CAF5"> error</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7DCFFF">message</span><span style="--shiki-default:#9ABDF5"> })</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="157"><span style="--shiki-default:#9ABDF5">  }
</span></span><span class="line" line="158"><span style="--shiki-default:#9ABDF5">}</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="159"><span emptylineplaceholder="true">
</span></span><span class="line" line="160"><span style="--shiki-default:#C0CAF5">app</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">post</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">/v1/scale-up</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#C0CAF5"> scaleUpHandler</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="161"><span style="--shiki-default:#C0CAF5">app</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">post</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">/v1/scale-down</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#C0CAF5"> scaleDownHandler</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="162"><span emptylineplaceholder="true">
</span></span><span class="line" line="163"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">const</span><span style="--shiki-default:#BB9AF7"> PORT</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#FF9E64"> 4000</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="164"><span style="--shiki-default:#C0CAF5">app</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">listen</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#FF9E64">PORT</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#9ABDF5"> ()</span><span style="--shiki-default:#BB9AF7"> =&gt;</span><span style="--shiki-default:#C0CAF5"> console</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">log</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#89DDFF">`</span><span style="--shiki-default:#9ECE6A">Server running on port </span><span style="--shiki-default:#7DCFFF">${</span><span style="--shiki-default:#FF9E64">PORT</span><span style="--shiki-default:#7DCFFF">}</span><span style="--shiki-default:#89DDFF">`</span><span style="--shiki-default:#9ABDF5">))</span><span style="--shiki-default:#89DDFF">;
</span></span></code><!--]--></pre></div><br>Jalankan Webhook handler menggunakan PM2, Panduan bisa dilihat diatas.<!--]--></li><li><!--[-->Test endpoint webhook handler<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">curl</span><span style="--shiki-default:#E0AF68"> -X</span><span style="--shiki-default:#9ECE6A"> POST</span><span style="--shiki-default:#9ECE6A"> http://localhost:4000/v1/scale-up
</span></span></code><!--]--></pre></div><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">curl</span><span style="--shiki-default:#E0AF68"> -X</span><span style="--shiki-default:#9ECE6A"> POST</span><span style="--shiki-default:#9ECE6A"> http://localhost:4000/v1/scale-down
</span></span></code><!--]--></pre></div><!--]--></li><!--]--></ol><h3 id="install-grafana"><a href="#install-grafana"><!--[-->Install Grafana<!--]--></a></h3><p><!--[-->Sekarang Prometheus mengumpulkan statistik dari klien yang terdaftar di bagian <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->scrape_configs<!--]--></code> pada file konfigurasinya. Namun, informasi tersebut hanya dapat dilihat dalam bentuk data mentah yang sulit dibaca dan kurang berguna.<!--]--></p><p><!--[-->Grafana menyediakan antarmuka untuk melihat statistik yang dikumpulkan oleh Prometheus. Grafana juga akan digunakan sebagai<!--]--></p><ol><!--[--><li><!--[-->Instal beberapa utilitas yang dibutuhkan menggunakan apt.<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> apt-get</span><span style="--shiki-default:#9ECE6A"> install</span><span style="--shiki-default:#E0AF68"> -y</span><span style="--shiki-default:#9ECE6A"> apt-transport-https</span><span style="--shiki-default:#9ECE6A"> software-properties-common
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Impor kunci GPG Grafana.<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> wget</span><span style="--shiki-default:#E0AF68"> -q</span><span style="--shiki-default:#E0AF68"> -O</span><span style="--shiki-default:#9ECE6A"> /usr/share/keyrings/grafana.key</span><span style="--shiki-default:#9ECE6A"> https://apt.grafana.com/gpg.key
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Tambahkan repository &quot;stable releases&quot; Grafana.<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#0DB9D7">echo</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">deb [signed-by=/usr/share/keyrings/grafana.key] https://apt.grafana.com stable main</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF"> |</span><span style="--shiki-default:#C0CAF5"> sudo</span><span style="--shiki-default:#9ECE6A"> tee</span><span style="--shiki-default:#E0AF68"> -a</span><span style="--shiki-default:#9ECE6A"> /etc/apt/sources.list.d/grafana.list
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Update paket, termasuk paket Grafana yang baru.<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> apt-get</span><span style="--shiki-default:#9ECE6A"> update
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Install versi open-source dari Grafana.<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> apt-get</span><span style="--shiki-default:#9ECE6A"> install</span><span style="--shiki-default:#9ECE6A"> grafana
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Muat ulang daemon systemctl.<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> systemctl</span><span style="--shiki-default:#9ECE6A"> daemon-reload
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Aktifkan dan mulai server Grafana. Menggunakan <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->systemctl enable<!--]--></code>.<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> systemctl</span><span style="--shiki-default:#9ECE6A"> enable</span><span style="--shiki-default:#9ECE6A"> grafana-server.service
</span></span><span class="line" line="2"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> systemctl</span><span style="--shiki-default:#9ECE6A"> start</span><span style="--shiki-default:#9ECE6A"> grafana-server
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Periksa status server Grafana.<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>bash</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-bash shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">sudo</span><span style="--shiki-default:#9ECE6A"> systemctl</span><span style="--shiki-default:#9ECE6A"> status</span><span style="--shiki-default:#9ECE6A"> grafana-server
</span></span></code><!--]--></pre></div><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md"><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><!----></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="overflow-auto p-3"><!--[--><code>grafana-server.service - Grafana instance
Loaded: loaded (/lib/systemd/system/grafana-server.service; enabled; vendor preset: enabled)
Active: active (running) since Tue 2023-04-11 17:31:53 UTC; 9s ago
</code><!--]--></pre></div><!--]--></li><!--]--></ol><h3 id="menambahkan-prometheus-sebagai-sumber-data"><a href="#menambahkan-prometheus-sebagai-sumber-data"><!--[-->Menambahkan Prometheus Sebagai Sumber Data<!--]--></a></h3><p><!--[-->Semua komponen sistem sekarang sudah terinstal, tetapi Grafana dan Prometheus belum diatur untuk berinteraksi. Untuk menambahkan Prometheus sebagai sumber data dan konfigurasi lainnya, dapat dilakukan menggunakan antarmuka web Grafana.<!--]--></p><p><!--[-->Untuk mengintegrasikan Grafana dan Prometheus, ikuti langkah-langkah di bawah ini:<!--]--></p><ol><!--[--><li><!--[-->Login ke grafana<br>Dengan menggunakan browser, pergi ke halaman http://<public-up-server-monitoring>:3000</public-up-server-monitoring><br>Login ke grafana menggunakan default password dan username yaitu<br>Username: admin
Password: admin<br>Setelah itu Grafana akan meminta kita untuk mengubah kata sandi. Setelah berhasil mengubah kata sandi, Grafana akan menampilkan <strong><!--[-->Grafana Dashboard<!--]--></strong>.<!--]--></li><li><!--[-->Tambah Prometheus sebagai sumber data<br>Pada menu connection pergi ke halaman data source lalu klik add data source<div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/add-data-source.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><br>Pilih <strong><!--[-->Prometheus<!--]--></strong> sebagai data source.<div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/pilih-prometheus.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><br>Karena server prometheus sudah berjalan pada server yang sama, isi bagian connection dengan url <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->http://localhost:9090<!--]--></code><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/pilih-prometheus.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><br>Pengaturan lainnya bisa ditinggalkan menggunakan yang default<br>Klik &quot;Save &amp; test&quot;, Jika berhasil Prometheus akan mengeluarkan pesan sukses<div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/pesan-sukses-prometheus.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><!--]--></li><!--]--></ol><h3 id="cara-mengimpor-dashboard-grafana"><a href="#cara-mengimpor-dashboard-grafana"><!--[-->Cara Mengimpor Dashboard Grafana<!--]--></a></h3><p><!--[-->Dashboard menampilkan statistik dari data source menggunakan diagram, grafik, dengan tata letak yang efisien dan mudah dipahami. Anda bisa membuat dashboard kustom, tetapi Prometheus telah menyediakan dashboard yang mendukung data dari <strong><!--[-->Node Exporter<!--]--></strong>. Dashboard <strong><!--[-->Node Exporter Full<!--]--></strong> menggambarkan sebagian besar nilai yang dikumpulkan dari node klien. Lebih mudah mengimpor dashboard ini daripada membuat yang kustom.<!--]--></p><p><!--[-->Untuk mengimpor dashboard <strong><!--[-->Node Exporter<!--]--></strong>, ikuti langkah-langkah di bawah ini:<!--]--></p><ol><!--[--><li><!--[-->Pergi kehalaman dashboard, klik &quot;+ Create dashboard&quot;<!--]--></li><!--]--></ol><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/import-dashboard-grafana.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><p><!--[-->Lalu klik tombol &quot;Import dashboard&quot;<!--]--></p><ol start="2"><!--[--><li><!--[-->Pada halaman import dashboard masukan id Node Exporter Full dan klik &quot;Load&quot;<div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/import-dashboard-id.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><!--]--></li><li><!--[-->Beri nama dashboard dan pilih Prometheus sebagai datasource lalu klik import<div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/import-dashboard-pick-datasource.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><!--]--></li><li><!--[-->Jika dashboard berhasil dikonfigurasi maka akan memunculkan semua matrik yang disajikan oleh Node Exporter<div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/grafana-dashboard-finish.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><!--]--></li><!--]--></ol><h2 id="implementasi-alerting-menggunakan-grafana-alert"><a href="#implementasi-alerting-menggunakan-grafana-alert"><!--[-->Implementasi Alerting Menggunakan Grafana Alert<!--]--></a></h2><p><!--[-->Grafana memiliki fitur alerting. Pada bagian ini kita akan mendefiniskan alert rules beserta apa yang harus dilakukan ketika alert rules tersebut terpenuhi.<!--]--></p><h3 id="menentukan-parameter-yang-tepat-sebagai-acuan-untuk-scaling"><a href="#menentukan-parameter-yang-tepat-sebagai-acuan-untuk-scaling"><!--[-->Menentukan parameter yang tepat sebagai acuan untuk scaling<!--]--></a></h3><p><!--[-->Kita bisa menggunakan data penggunaan CPU, penggunaan RAM, atau gabungan keduanya sebagai acuan untuk scaling. Namun, setiap aplikasi memiliki karakteristik beban yang berbeda, ada yang lebih banyak menggunakan CPU dan ada yang lebih banyak menggunakan RAM.<!--]--></p><p><!--[-->Untuk mengetahui karakteristik aplikasi, kita dapat melakukan load testing menggunakan tools seperti Apache JMeter, Locust, atau k6. Tujuan dari pengujian ini adalah untuk mengidentifikasi <em><!--[-->bottleneck<!--]--></em> dalam sistem, apakah disebabkan oleh CPU atau RAM. Setelah <em><!--[-->bottleneck<!--]--></em> teridentifikasi, metrik tersebut dapat digunakan sebagai acuan untuk scaling.<!--]--></p><p><!--[-->Pada artikel ini apliaksi yang digunakan adalah CPU intensive. Jadi akan menggunakan query untuk mengmbil data Penggunaan CPU.<!--]--></p><h3 id="query-promql-untuk-mendapatkan-data-rata-rata-penggunaan-cpu-dan-ram"><a href="#query-promql-untuk-mendapatkan-data-rata-rata-penggunaan-cpu-dan-ram"><!--[-->Query PromQL Untuk Mendapatkan Data Rata-rata Penggunaan CPU dan RAM<!--]--></a></h3><p><!--[-->Berikut adalah query untuk mengumpulkan data penggunaan CPU, penggunaan RAM, atau gabungan keduanya.<!--]--></p><p><!--[-->Query ini akan digunakan pada bagian selanjutnya saat mengkonfigurasi alert rule.<!--]--></p><h4 id="menghitung-rata-rata-cpu-load"><a href="#menghitung-rata-rata-cpu-load"><!--[-->Menghitung Rata-rata CPU Load<!--]--></a></h4><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md"><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><!----></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="overflow-auto p-3"><!--[--><code>100 - (avg(
 rate(node_cpu_seconds_total{job=~&quot;calculate_service_seed|calculate_service_clone&quot;, mode=&quot;idle&quot;}[2m])
)*100)
</code><!--]--></pre></div><h4 id="menghitung-rata-rata-memory-used"><a href="#menghitung-rata-rata-memory-used"><!--[-->Menghitung Rata-rata Memory used<!--]--></a></h4><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md"><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><!----></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="overflow-auto p-3"><!--[--><code>100 * (1 - (
  sum(avg_over_time(node_memory_MemAvailable_bytes{job=~&quot;calculate_service_seed|calculate_service_clone&quot;}[3m]))
  /
  sum(avg_over_time(node_memory_MemTotal_bytes{job=~&quot;calculate_service_seed|calculate_service_clone&quot;}[3m]))
))
</code><!--]--></pre></div><h4 id="menghitung-rata-rata-penggunaan-memory-dan-cpu-usage"><a href="#menghitung-rata-rata-penggunaan-memory-dan-cpu-usage"><!--[-->Menghitung Rata-rata Penggunaan Memory dan CPU usage<!--]--></a></h4><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md"><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><!----></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="overflow-auto p-3"><!--[--><code>avg(
  100 - (rate(node_cpu_seconds_total{job=~&quot;calculate_service_seed|calculate_service_clone&quot;, mode=&quot;idle&quot;}[2m]) * 100)
)
+
avg(
  100 * (1 - (
    sum(avg_over_time(node_memory_MemAvailable_bytes{job=~&quot;calculate_service_seed|calculate_service_clone&quot;}[3m]))
    /
    sum(avg_over_time(node_memory_MemTotal_bytes{job=~&quot;calculate_service_seed|calculate_service_clone&quot;}[3m]))
  ))
)
/ 2
</code><!--]--></pre></div><h3 id="mengatur-contact-point"><a href="#mengatur-contact-point"><!--[-->Mengatur Contact Point<!--]--></a></h3><p><!--[-->Contact Point adalah mekanisme untuk mengirimkan notifikasi ketika suatu kondisi alert rule terpenuhi. Contact Point bertindak sebagai penghubung antara sistem monitoring di Grafana dengan platform komunikasi yang digunakan untuk menerima notifikasi, seperti email, Slack, Microsoft Teams, PagerDuty, atau webhook.<!--]--></p><p><!--[-->Pada bagian ini kita akan membuat contact point berupa webhook. Webhook ini adalah endpoint dari webhook handler yang dibuat pada bagian sebelumnya.<!--]--></p><p><!--[-->Webhook handler inilah yang kemudian akan menginisiasi proses scaling.<!--]--></p><p><!--[-->Untuk membuat contact point baru, dibawah bagian alerting klik &quot;Contact points&quot; lalu klik &quot;Create contact point&quot;<!--]--></p><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/contact-point-menu.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><p><!--[-->Berikut konfigurasi contact point untuk setiap event scaling<!--]--></p><h4 id="_1-contact-point-untuk-event-scale-down"><a href="#_1-contact-point-untuk-event-scale-down"><!--[-->1. Contact Point Untuk Event Scale Down<!--]--></a></h4><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/scaledown-contactpoint.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><h4 id="_2-contact-point-untuk-event-scale-up"><a href="#_2-contact-point-untuk-event-scale-up"><!--[-->2. Contact Point Untuk Event Scale Up<!--]--></a></h4><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/scaleup-contactpoint.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><h3 id="mengatur-alert-rule-untuk-event-scale-up"><a href="#mengatur-alert-rule-untuk-event-scale-up"><!--[-->Mengatur Alert Rule Untuk Event Scale Up<!--]--></a></h3><p><!--[-->Pada menu sidebar, pada bgaian alert rule, klik &quot;Alert rules&quot;. Lalu klik &quot;New alert rule&quot;.<!--]--></p><p><!--[-->Lalu masukan pengaturan berikut:<!--]--></p><h4 id="_1-scale-up-enter-alert-rule-name"><a href="#_1-scale-up-enter-alert-rule-name"><!--[-->1. Scale Up: Enter alert rule name<!--]--></a></h4><p><!--[-->Masukan nama dari alert rule<!--]--></p><h4 id="_2-scale-up-query-and-alert-condition"><a href="#_2-scale-up-query-and-alert-condition"><!--[-->2. Scale Up: Query and Alert Condition<!--]--></a></h4><p><!--[-->Ubah mode pembuatan query dari &quot;Builder&quot; ke &quot;Code&quot; lalu masukan kode query. Sesuaikan query dengan karakteristik aplikasi.<!--]--></p><p><!--[-->Pada artikel ini alert akan di-trigger jika CPU Usage melebihi 70%. Sesuaikan batas ini sesuai dengan aplikasi yang dijalankan. Pada tingkat penggunaan berapa persen sistem mulai mengembalikan response error?<!--]--></p><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/query-and-threshold.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><h4 id="_3-scale-up-set-evaluation-behaviour"><a href="#_3-scale-up-set-evaluation-behaviour"><!--[-->3. Scale Up: Set Evaluation Behaviour<!--]--></a></h4><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/set-eval-behaviour.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><h4 id="_4-scale-up-configure-labels-and-notification"><a href="#_4-scale-up-configure-labels-and-notification"><!--[-->4. Scale Up: Configure Labels and Notification<!--]--></a></h4><p><!--[-->Pilih contact point scale up yang sudah dibuat pada bagian sebelumnya<!--]--></p><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/label-and-notification.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><h4 id="_5-scale-up-configure-notification-message"><a href="#_5-scale-up-configure-notification-message"><!--[-->5. Scale Up: Configure Notification Message<!--]--></a></h4><p><!--[-->Bagian ini opsional<!--]--></p><h3 id="mengatur-alert-rule-untuk-event-scale-down"><a href="#mengatur-alert-rule-untuk-event-scale-down"><!--[-->Mengatur Alert Rule Untuk Event Scale Down<!--]--></a></h3><h4 id="_1-scale-down-enter-alert-rule-name"><a href="#_1-scale-down-enter-alert-rule-name"><!--[-->1. Scale Down: Enter alert rule name<!--]--></a></h4><p><!--[-->Masukan nama dari alert rule<!--]--></p><h4 id="_2-scale-down-query-and-alert-condition"><a href="#_2-scale-down-query-and-alert-condition"><!--[-->2. Scale Down: Query and Alert Condition<!--]--></a></h4><p><!--[-->Sesuaikan query dengan karakteristik aplikasi.<!--]--></p><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/query-and-threshold-scaledown.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><h4 id="_3-scale-down-set-evaluation-behaviour"><a href="#_3-scale-down-set-evaluation-behaviour"><!--[-->3. Scale Down: Set Evaluation Behaviour<!--]--></a></h4><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/set-eval-behaviour-scaledown.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/mute-timing-scaledown.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><h4 id="_4-scale-down-configure-labels-and-notification"><a href="#_4-scale-down-configure-labels-and-notification"><!--[-->4. Scale Down: Configure Labels and Notification<!--]--></a></h4><p><!--[-->Pilih contact point scale down<!--]--></p><h4 id="_5-scale-down-configure-notification-message"><a href="#_5-scale-down-configure-notification-message"><!--[-->5. Scale Down: Configure Notification Message<!--]--></a></h4><p><!--[-->Bagian ini opsional<!--]--></p><h2 id="load-testing-untuk-memastikan-fungsionalitas-arsitektur-secara-keseluruhan"><a href="#load-testing-untuk-memastikan-fungsionalitas-arsitektur-secara-keseluruhan"><!--[-->Load Testing Untuk Memastikan Fungsionalitas Arsitektur Secara Keseluruhan.<!--]--></a></h2><p><!--[-->Load testing adalah bentuk tes dengan mengirimkan request ke aplikasi dengan beban bervariasi untuk melihat reaksi sistem pada beragam volume request.<!--]--></p><p><!--[-->Pada bagian ini akan dijelaskan pembuatan load testing untuk mentrigger event scale up dan scale down<!--]--></p><p><!--[-->Load testing akan menggunakan Grafana K6 yang dijalankan di komputer lokal, berikut adalah panduan membuat kode load testing menggunakan K6<!--]--></p><h3 id="merancang-kode-testing"><a href="#merancang-kode-testing"><!--[-->Merancang Kode Testing<!--]--></a></h3><p><!--[-->Untuk melakukan testing fitur scale down dan scale up kita harus bisa mengatur secara presisi berapa banyak request yang dikimkan ke server. Artinya kita harus bisa mengendalikan Request per second (RPS), ini diperlukan agar kita bisa mengontrol CPU Load secara presisi.<!--]--></p><p><!--[-->Selain itu kita harus bisa mengatur testing yang ramping artinya testing yang seiring waktu meningkat untuk mensimulasikan trafic pada sehingga mentrigger scale up lalu menurunkan traffic untuk mensimulasikan trafic yang sepi sehingga mentrigger scale down.<!--]--></p><p><!--[-->Untuk memenuhi kebutuhan ini kita akan menggunakan executor dari K6 yaitu <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->rampign-arrival-rate<!--]--></code> . Executor ini memungkinkan kita untuk mengatur RPS secara presisi dan menaikan atau menurunkan RPS seiring waktu.<!--]--></p><p><!--[-->Kita juga akan menggunakan K6 reporter berupa HTML Report untuk menvisualisasikan hasil dari load testing. Saat load testing berakhir, akan muncul file <code class="font-semibold bg-gray-200 dark:bg-gray-700 text-fruit-salad-600 dark:text-fruit-salad-400 px-1 rounded"><!--[-->summary.html<!--]--></code> yang berisi hasil load testing. Berikut panduan menggunakan K6 untuk load testing.<!--]--></p><ol><!--[--><li><!--[-->Instalasi K6<br>Pergi ke halaman dokumentasi ini dan install K6 sesuai dengan OS.<br><a href="https://grafana.com/docs/k6/latest/set-up/install-k6/" rel="nofollow"><!--[-->https://grafana.com/docs/k6/latest/set-up/install-k6/<!--]--></a><!--]--></li><li><!--[-->Buat sebuah file javascript dan isi dengan kode berikut:<div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><span>loadTest.js</span></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-js shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#7DCFFF">import</span><span style="--shiki-default:#0DB9D7"> http</span><span style="--shiki-default:#7DCFFF"> from</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">k6/http</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="2"><span style="--shiki-default:#7DCFFF">import</span><span style="--shiki-default:#9ABDF5"> { </span><span style="--shiki-default:#0DB9D7">check</span><span style="--shiki-default:#9ABDF5"> }</span><span style="--shiki-default:#7DCFFF"> from</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">k6</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="3"><span style="--shiki-default:#7DCFFF">import</span><span style="--shiki-default:#9ABDF5"> { </span><span style="--shiki-default:#0DB9D7">htmlReport</span><span style="--shiki-default:#9ABDF5"> }</span><span style="--shiki-default:#7DCFFF"> from</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">https://raw.githubusercontent.com/benc-uk/k6-reporter/main/dist/bundle.js</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="4"><span emptylineplaceholder="true">
</span></span><span class="line" line="5"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">// Akan dijalankan skenario &#39;endpoint_test&#39;
</span></span><span class="line" line="6"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">// Menggunakan ramping arrival state executor
</span></span><span class="line" line="7"><span style="--shiki-default:#7DCFFF">export</span><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic"> const</span><span style="--shiki-default:#BB9AF7"> options</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="8"><span style="--shiki-default:#73DACA">  discardResponseBodies</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#FF9E64"> true</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="9"><span style="--shiki-default:#73DACA">  scenarios</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="10"><span style="--shiki-default:#73DACA">    endpoint_test</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="11"><span style="--shiki-default:#41A6B5">      executor</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">ramping-arrival-rate</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="12"><span emptylineplaceholder="true">
</span></span><span class="line" line="13"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">      // Volume request akan dimulai pada 1 request/detik
</span></span><span class="line" line="14"><span style="--shiki-default:#41A6B5">      startRate</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#FF9E64"> 1</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="15"><span style="--shiki-default:#41A6B5">      timeUnit</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">1s</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="16"><span emptylineplaceholder="true">
</span></span><span class="line" line="17"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">      // Virtual yagn digunakan berjumlah 25
</span></span><span class="line" line="18"><span style="--shiki-default:#41A6B5">      preAllocatedVUs</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#FF9E64"> 25</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="19"><span emptylineplaceholder="true">
</span></span><span class="line" line="20"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">      // Total durasi test 20 menit
</span></span><span class="line" line="21"><span style="--shiki-default:#41A6B5">      stages</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#9ABDF5"> [
</span></span><span class="line" line="22"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">        // 1 menit pertama 1 RPS
</span></span><span class="line" line="23"><span style="--shiki-default:#9ABDF5">        {</span><span style="--shiki-default:#41A6B5"> target</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#FF9E64"> 1</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#41A6B5"> duration</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">1m</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5"> }</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="24"><span emptylineplaceholder="true">
</span></span><span class="line" line="25"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">        // 1 menit kemudian volume naik perlahan ke 6 RPS
</span></span><span class="line" line="26"><span style="--shiki-default:#9ABDF5">        {</span><span style="--shiki-default:#41A6B5"> target</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#FF9E64"> 6</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#41A6B5"> duration</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">1m</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5"> }</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="27"><span emptylineplaceholder="true">
</span></span><span class="line" line="28"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">        // 13 menit kemudian tetap pada 6 RPS
</span></span><span class="line" line="29"><span style="--shiki-default:#9ABDF5">        {</span><span style="--shiki-default:#41A6B5"> target</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#FF9E64"> 6</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#41A6B5"> duration</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">13m</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5"> }</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="30"><span emptylineplaceholder="true">
</span></span><span class="line" line="31"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">        // 2 menit kemudian turun perlahan ke 1 RPS
</span></span><span class="line" line="32"><span style="--shiki-default:#9ABDF5">        {</span><span style="--shiki-default:#41A6B5"> target</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#FF9E64"> 1</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#41A6B5"> duration</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">2m</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5"> }</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="33"><span emptylineplaceholder="true">
</span></span><span class="line" line="34"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">        // 3 menit kemudian tetap pada 1 RPS
</span></span><span class="line" line="35"><span style="--shiki-default:#9ABDF5">        {</span><span style="--shiki-default:#41A6B5"> target</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#FF9E64"> 1</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#41A6B5"> duration</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">3m</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5"> }</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="36"><span style="--shiki-default:#9ABDF5">      ]</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="37"><span style="--shiki-default:#9ABDF5">    }</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="38"><span style="--shiki-default:#9ABDF5">  }</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="39"><span style="--shiki-default:#9ABDF5">}</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="40"><span emptylineplaceholder="true">
</span></span><span class="line" line="41"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">// Function untuk mengirim request
</span></span><span class="line" line="42"><span style="--shiki-default:#7DCFFF">export</span><span style="--shiki-default:#7DCFFF"> default</span><span style="--shiki-default:#BB9AF7"> function</span><span style="--shiki-default:#9ABDF5"> ()</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="43"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">  // GANTI IP ADDRESS
</span></span><span class="line" line="44"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">  const</span><span style="--shiki-default:#BB9AF7"> url</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">http://103.171.84.152/calculate</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="45"><span emptylineplaceholder="true">
</span></span><span class="line" line="46"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">  const</span><span style="--shiki-default:#BB9AF7"> randomNumber</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#C0CAF5"> Math</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">floor</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">Math</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">random</span><span style="--shiki-default:#9ABDF5">() </span><span style="--shiki-default:#89DDFF">*</span><span style="--shiki-default:#FF9E64"> 9999</span><span style="--shiki-default:#9ABDF5">) </span><span style="--shiki-default:#89DDFF">+</span><span style="--shiki-default:#FF9E64"> 1</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="47"><span emptylineplaceholder="true">
</span></span><span class="line" line="48"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">  const</span><span style="--shiki-default:#BB9AF7"> body</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#0DB9D7"> JSON</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">stringify</span><span style="--shiki-default:#9ABDF5">({ </span><span style="--shiki-default:#73DACA">number</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#C0CAF5"> randomNumber</span><span style="--shiki-default:#9ABDF5"> })</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="49"><span emptylineplaceholder="true">
</span></span><span class="line" line="50"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">  const</span><span style="--shiki-default:#BB9AF7"> headers</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#9ABDF5"> { </span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ECE6A">Content-Type</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#89DDFF"> &quot;</span><span style="--shiki-default:#9ECE6A">application/json</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#9ABDF5"> }</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="51"><span emptylineplaceholder="true">
</span></span><span class="line" line="52"><span style="--shiki-default:#9D7CD8;--shiki-default-font-style:italic">  const</span><span style="--shiki-default:#BB9AF7"> res</span><span style="--shiki-default:#89DDFF"> =</span><span style="--shiki-default:#C0CAF5"> http</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7AA2F7">post</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">url</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#C0CAF5"> body</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#9ABDF5"> { </span><span style="--shiki-default:#73DACA">headers</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#C0CAF5"> headers</span><span style="--shiki-default:#9ABDF5"> })</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="53"><span emptylineplaceholder="true">
</span></span><span class="line" line="54"><span style="--shiki-default:#7AA2F7">  check</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">res</span><span style="--shiki-default:#89DDFF">,</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="55"><span style="--shiki-default:#89DDFF">    &quot;</span><span style="--shiki-default:#9ECE6A">status is 200</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#9ABDF5"> (</span><span style="--shiki-default:#E0AF68">r</span><span style="--shiki-default:#9ABDF5">) </span><span style="--shiki-default:#BB9AF7">=&gt;</span><span style="--shiki-default:#C0CAF5"> r</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7DCFFF">status</span><span style="--shiki-default:#BB9AF7"> ===</span><span style="--shiki-default:#FF9E64"> 200</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="56"><span style="--shiki-default:#9ABDF5">  })</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="57"><span style="--shiki-default:#9ABDF5">}
</span></span><span class="line" line="58"><span emptylineplaceholder="true">
</span></span><span class="line" line="59"><span style="--shiki-default:#51597D;--shiki-default-font-style:italic">// Setup HTML Report
</span></span><span class="line" line="60"><span style="--shiki-default:#7DCFFF">export</span><span style="--shiki-default:#BB9AF7"> function</span><span style="--shiki-default:#7AA2F7"> handleSummary</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#E0AF68">data</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="61"><span style="--shiki-default:#BB9AF7;--shiki-default-font-style:italic">  return</span><span style="--shiki-default:#9ABDF5"> {
</span></span><span class="line" line="62"><span style="--shiki-default:#89DDFF">    &quot;</span><span style="--shiki-default:#9ECE6A">summary.html</span><span style="--shiki-default:#89DDFF">&quot;</span><span style="--shiki-default:#89DDFF">:</span><span style="--shiki-default:#7AA2F7"> htmlReport</span><span style="--shiki-default:#9ABDF5">(</span><span style="--shiki-default:#C0CAF5">data</span><span style="--shiki-default:#9ABDF5">)</span><span style="--shiki-default:#89DDFF">,
</span></span><span class="line" line="63"><span style="--shiki-default:#9ABDF5">  }</span><span style="--shiki-default:#89DDFF">;
</span></span><span class="line" line="64"><span style="--shiki-default:#9ABDF5">}
</span></span></code><!--]--></pre></div><!--]--></li><li><!--[-->Menjalankan Testing<!--]--></li><!--]--></ol><p><!--[-->Buka terminal dan jalankan command berikut:<!--]--></p><div class="relative bg-gray-800 text-gray-100 rounded-md shadow-md" style=""><div class="px-3 py-1 flex justify-between border-b border-gray-600"><div class="text-gray-300 text-sm rounded-tl-md rounded-br-md"><!----></div><button class="flex items-center justify-center bg-gray-800 border border-gray-600 w-6 h-6 text-sm text-white rounded-md hover:bg-fruit-salad-400 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" class="mx-auto"><!--[--><!--]--><g><path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></g></svg><!----></button></div><pre class="language-jsx shiki shiki-themes tokyo-night overflow-auto p-3"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#C0CAF5">k6</span><span style="--shiki-default:#C0CAF5"> run</span><span style="--shiki-default:#C0CAF5"> loadTest</span><span style="--shiki-default:#89DDFF">.</span><span style="--shiki-default:#7DCFFF">js
</span></span></code><!--]--></pre></div><h3 id="analisis-hasil-testing"><a href="#analisis-hasil-testing"><!--[-->Analisis Hasil Testing<!--]--></a></h3><p><!--[-->Berikut adalah grafik yang menunjukan persentasi penggunaan CPU pada Service seed<!--]--></p><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/graph-load-cpu.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><p><!--[-->Dan berikut adalah grafik hasil dari load testing. Untuk mendapatkan laporan grafik seperti ini load testing harus dijalankan melalui Grafana Cloud.<!--]--></p><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/hasil-load-testing.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><p><!--[-->Berikut adalah perbandingan dari kedua grafik tersebut.<!--]--></p><div data-v-49ad29a5><img src="/blog/idcloudhost-autoscaling/perbandingan-graph-testing.png" class="cursor-pointer bg-white" data-v-49ad29a5><!----></div><ol><!--[--><li><!--[-->Stage 1 dimulai dengan 1 RPS<!--]--></li><li><!--[-->Stage 1 berakhir dan stage 2 dimulai. RPS naik perlahan dari 1 ke 6. Sistem mulai mengalami load yang tinggi<!--]--></li><li><!--[-->Stage 2 berakhir dan stage 3 dimulai. Volume request stabil di 6 RPS. Sistem mengalami lebih dari 70% CPU Load. Scale up diinisiasi.<!--]--></li><li><!--[-->Masih dalam stage 3. Proses scaling selesai dan load dari Service seed terbagi dua dengan server service baru<!--]--></li><li><!--[-->Stage 3 berakhir dan stage 4 dimulai. Volume request turunperlahan ke 1 RPS. Di tengah-tengah stage ini sistem mengalami CPU load dibawah 30%. Scale down dimulai.<!--]--></li><li><!--[-->Stage 4 berakhir dan stage 5 dimulai. Volume request tetap berada di 1 RPS. Scale down selesai sehingga beban kerja server service seed meningkat sedikit. Terdapat juga lonjakan pada Failure rate, ini dikarenakan ketika server clone dihapus, masih ada request yang belum diselesaikan oleh server tersebut.<!--]--></li><!--]--></ol><style>html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}</style></div><!--]--></div></div><!--]--></div><div class="hidden lg:block w-3/12 p-4 lg:sticky lg:top-0 lg:max-h-screen lg:overflow-y-auto no-scrollbar"><div><div class="flex items-center justify-end gap-3 pr-8"><div><!----></div><img onerror="this.setAttribute(&#39;data-error&#39;, 1)" data-nuxt-img srcset="/_ipx/_/img/logo-personal.png 1x, /_ipx/_/img/logo-personal.png 2x" class="w-36 h-auto" src="/_ipx/_/img/logo-personal.png"></div><!----></div></div></div></div></div></div><div id="teleports"></div><script type="application/json" data-nuxt-data="nuxt-app" data-ssr="true" id="__NUXT_DATA__" data-src="/blog/autoscaling-pada-idcloudhost-menggunakan-grafana-traefik/_payload.json?492af120-ee34-4ae2-b810-b2432bee4326">[{"state":1,"once":7,"_errors":8,"serverRendered":5,"path":11,"pinia":12,"prerenderedAt":17},["Reactive",2],{"$scolor-mode":3},{"preference":4,"value":4,"unknown":5,"forced":6},"system",true,false,["Set"],["ShallowReactive",9],{"article":10,"content-query-Q74OnBWMtE":10},null,"/blog/autoscaling-pada-idcloudhost-menggunakan-grafana-traefik",["Reactive",13],{"blog":14},{"currentArticle":15},["Ref",16],"CEK",1732003024818]</script>
<script>window.__NUXT__={};window.__NUXT__.config={public:{mdc:{useNuxtImage:true,components:{prose:true,map:{p:"prose-p",a:"prose-a",blockquote:"prose-blockquote","code-inline":"prose-code-inline",code:"ProseCodeInline",em:"prose-em",h1:"prose-h1",h2:"prose-h2",h3:"prose-h3",h4:"prose-h4",h5:"prose-h5",h6:"prose-h6",hr:"prose-hr",img:"prose-img",ul:"prose-ul",ol:"prose-ol",li:"prose-li",strong:"prose-strong",table:"prose-table",thead:"prose-thead",tbody:"prose-tbody",td:"prose-td",th:"prose-th",tr:"prose-tr"}},headings:{anchorLinks:{h1:false,h2:true,h3:true,h4:true,h5:false,h6:false}}},content:{locales:[],defaultLocale:"",integrity:1732003005852,experimental:{stripQueryParameters:false,advanceQuery:false,clientDB:false},respectPathCase:false,api:{baseURL:"/api/_content"},navigation:{fields:[]},tags:{p:"prose-p",a:"prose-a",blockquote:"prose-blockquote","code-inline":"prose-code-inline",code:"ProseCodeInline",em:"prose-em",h1:"prose-h1",h2:"prose-h2",h3:"prose-h3",h4:"prose-h4",h5:"prose-h5",h6:"prose-h6",hr:"prose-hr",img:"prose-img",ul:"prose-ul",ol:"prose-ol",li:"prose-li",strong:"prose-strong",table:"prose-table",thead:"prose-thead",tbody:"prose-tbody",td:"prose-td",th:"prose-th",tr:"prose-tr"},highlight:{theme:"tokyo-night",highlighter:"shiki",langs:["js","jsx","json","ts","tsx","vue","css","html","bash","md","mdc","yaml"]},wsUrl:"",documentDriven:false,host:"",trailingSlash:false,search:"",contentHead:true,anchorLinks:{depth:4,exclude:[1]}},gtag:{enabled:true,initMode:"auto",id:"G-3QHM1F5N2M",initCommands:[],config:{},tags:[],loadingStrategy:"defer",url:"https://www.googletagmanager.com/gtag/js"},studio:{apiURL:"https://api.nuxt.studio",iframeMessagingAllowedOrigins:""}},app:{baseURL:"/",buildId:"492af120-ee34-4ae2-b810-b2432bee4326",buildAssetsDir:"/_nuxt/",cdnURL:""}}</script></body></html>